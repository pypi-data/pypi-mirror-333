name: Analyze GitHub Stats

on:
  push:
    branches: [ main, master ]  # åœ¨æ¨é€åˆ° main æˆ– master åˆ†æ”¯æ—¶è§¦å‘

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'  # ä½¿ç”¨æœ€æ–°çš„ Python ç‰ˆæœ¬
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        # å®‰è£…å½“å‰åŒ…
        pip install -e .
    
    - name: Run analysis
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        # åˆ›å»ºç»“æœç›®å½•
        mkdir -p results
        
        # è¿è¡Œåˆ†æå™¨å¹¶å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶
        echo '```' > results/RESULT.md
        github-stats ${{ github.repository_owner }} --access-level full >> results/RESULT.md
        echo '```' >> results/RESULT.md
        
        # æ·»åŠ æ—¶é—´æˆ³å’Œ Python ç‰ˆæœ¬ä¿¡æ¯
        echo -e "\n\n---\nLast updated: $(date -u)\nPython version: $(python --version)" >> results/RESULT.md
    
    - name: Update README
      run: |
        # æ›´æ–° README.md
        echo -e "\n## ğŸ“Š Latest Analysis Results\n\nView the latest analysis results in the [stats branch](https://github.com/${{ github.repository }}/tree/stats/results/RESULT.md).\n" >> README.md
        
        # æ›´æ–° README_CN.md
        echo -e "\n## ğŸ“Š æœ€æ–°åˆ†æç»“æœ\n\nåœ¨ [stats åˆ†æ”¯](https://github.com/${{ github.repository }}/tree/stats/results/RESULT.md) ä¸­æŸ¥çœ‹æœ€æ–°åˆ†æç»“æœã€‚\n" >> README_CN.md
    
    - name: Create and push to stats branch
      run: |
        # åˆ›å»ºå¹¶åˆ‡æ¢åˆ° stats åˆ†æ”¯
        git checkout -b stats
        
        # æ·»åŠ ç»“æœæ–‡ä»¶
        git add results/RESULT.md README.md README_CN.md
        
        # æäº¤æ›´æ”¹
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git commit -m "Update analysis results [skip ci]" || exit 0
        
        # å¼ºåˆ¶æ¨é€åˆ° stats åˆ†æ”¯
        git push -f origin stats 