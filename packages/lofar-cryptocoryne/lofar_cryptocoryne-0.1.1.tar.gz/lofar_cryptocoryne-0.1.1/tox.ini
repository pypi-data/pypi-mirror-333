[tox]
requires =
    tox>=4.21
env_list =
    fix
    pep8
    black
    pylint
    py3{12, 11, 10, 9}

[testenv]
package = editable
wheel_build_env = .pkg
deps =
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/tests/requirements.txt
set_env =
    LANGUAGE = en_US
    LC_ALL = en_US.UTF-8
    PYTHONWARNINGS = default::DeprecationWarning
commands =
    {envpython} --version
    {envpython} -m pytest

[testenv:fix]
description = format the code base to adhere to our styles, and complain about what we cannot do automatically
skip_install = true
deps =
    pre-commit-uv>=4.1.1
commands =
    pre-commit run --all-files --show-diff-on-failure

[testenv:coverage]
commands =
    {envpython} --version
    {envpython} -m pytest --cov-report term --cov-report xml --cov-report html --cov=lofar_cryptocoryne

[testenv:{pep8,black,pylint,format}]
commands =
    pep8: {envpython} -m flake8 --version
    pep8: {envpython} -m flake8 {posargs:lofar_cryptocoryne tests}
    black: {envpython} -m black --version
    black: {envpython} -m black --check --diff {posargs:lofar_cryptocoryne tests}
    pylint: {envpython} -m pylint --version
    pylint: {envpython} -m pylint {posargs:lofar_cryptocoryne tests}
    format: {envpython} -m autopep8 -v -aa --in-place --recursive {posargs:lofar_cryptocoryne}
    format: {envpython} -m autopep8 -v -aa --in-place --recursive {posargs:tests}
    format: {envpython} -m black -v {posargs:lofar_cryptocoryne tests}
env_dir = {toxworkdir}/linting

[testenv:docs]
deps =
    -r{toxinidir}/docs/requirements.txt
    -r{toxinidir}/requirements.txt
set_env =
change_dir = {toxinidir}
commands =
    {envpython} docs/cleanup.py
    sphinx-build -b html docs/source docs/build/html

[testenv:build]
deps =
    build
commands =
    {envpython} -m build
