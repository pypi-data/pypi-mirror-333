{% extends "base.html" %}

{% block content %}
<style>
    /* ğŸ“Œ èƒŒæ™¯ç”»åƒã‚’è¨­å®š */
    body {
        background-image: url("{{ url_for('static', filename='img/background.webp') }}");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
    }

    /* ğŸ“Œ `content-container` ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
    .content-container {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 10px 20px;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        max-width: 1920px;
        width: 100%;
        min-height: 500px;
        height: auto;
    }

    /* ğŸ“Œ `table-responsive` ã«é«˜ã•ã‚’æŒ‡å®šã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¯èƒ½ã«ã™ã‚‹ */
    .table-responsive {
        max-height: 600px;
        overflow-y: auto;
    }

    /* ğŸ“Œ h2 ã®ä½™ç™½ã‚’èª¿æ•´ */
    .content-container h2 {
        margin-top: 5px;
        margin-bottom: 5px;
        font-size: 1.8rem;
    }

    /* ğŸ“Œ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ã‚’ä¸­å¤®æƒãˆã« */
    table {
        text-align: center;
    }
    th, td {
        text-align: center !important;
        vertical-align: middle; /* ğŸ“Œ ç¸¦æ–¹å‘ã®ä¸­å¤®æƒãˆ */
        font-size: 24px;
    }

    /* ğŸ“Œ å„ã‚«ãƒ©ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆconfig.py ã® `TABLE_CELL_STYLES` ã‚’é©ç”¨ï¼‰ */
    {% for table, columns in cell_styles.items() %}
        {% for col, rules in columns.items() %}
            {% if "width" in rules %}
                th[data-column="{{ col }}"], td[data-column="{{ col }}"] {
                    width: {{ rules["width"] }} !important;
                }
            {% endif %}
            {% if "font_size" in rules %}
                td[data-column="{{ col }}"] {
                    font-size: {{ rules["font_size"] }} !important;
                }
            {% endif %}
            {% if "align" in rules %}
                td[data-column="{{ col }}"] {
                    text-align: {{ rules["align"] }} !important;
                }
            {% endif %}
            {% if "bold" in rules and rules["bold"] %}
                td[data-column="{{ col }}"] {
                    font-weight: bold !important;
                }
            {% endif %}
        {% endfor %}
    {% endfor %}
</style>

<div class="container content-container">
    <h2>{{ table_name }} ãƒ†ãƒ¼ãƒ–ãƒ«</h2>

    <div class="table-responsive">
        <table id="dataTable" class="table table-striped table-hover mt-3">
            <thead class="table-primary">
                <tr>
                    {% for col in columns %}
                        <th data-column="{{ col }}"
                            style="width: {% if col in cell_styles[table_name] and 'width' in cell_styles[table_name][col] %}
                                {{ cell_styles[table_name][col]['width'] }}{% else %}auto{% endif %};">
                            {{ col }}
                        </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                    <tr>
                        {% for col in columns %}
                            {% set style_class = "" %}
                            {% set cell_value = row[col] %}

                            {% if table_name in cell_styles and col in cell_styles[table_name] %}
                                {% set rules = cell_styles[table_name][col] %}
                                
                                {# ğŸ”¹ cell_value ãŒæ•°å€¤ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã€æ•°å€¤ãªã‚‰ float ã«å¤‰æ› #}
                                {% if cell_value is not string and cell_value is number %}
                                    {% set cell_value = cell_value|float %}
                                {% endif %}

                                {% if cell_value is number %}
                                    {% if "greater_than" in rules and cell_value > rules["greater_than"]["value"]|float %}
                                        {% set style_class = rules["greater_than"]["class"] %}
                                    {% elif "less_than" in rules and cell_value < rules["less_than"]["value"]|float %}
                                        {% set style_class = rules["less_than"]["class"] %}
                                    {% elif "equal_to" in rules and cell_value == rules["equal_to"]["value"]|float %}
                                        {% set style_class = rules["equal_to"]["class"] %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}

                            {# ğŸ”¹ æ–‡å­—åˆ—ã¯ãã®ã¾ã¾è¡¨ç¤ºã—ã€æ•°å€¤ã®ã¿æ•´æ•°ãƒ»å°æ•°ã®åˆ¤å®š #}
                            <td class="{{ style_class }}" data-column="{{ col }}" data-value="{{ row[col] }}" data-class="{{ style_class }}">
                                {% if cell_value is number %}
                                    {% if cell_value == cell_value|int %}
                                        {{ cell_value|int }}
                                    {% else %}
                                        {{ cell_value|float }}
                                    {% endif %}
                                {% else %}
                                    {{ cell_value }}
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- DataTables ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.dataTables.min.css') }}">

<script>
$(document).ready(function() {
    var table = $('#dataTable').DataTable({
        paging: true,
        searching: true,
        ordering: true,
        pageLength: 25,
        lengthMenu: [5, 10, 25, 50, 100],
        language: {
            search: "ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:",
            lengthMenu: "è¡¨ç¤º _MENU_ ä»¶",
            info: "å…¨ _TOTAL_ ä»¶ä¸­ _START_ ã‹ã‚‰ _END_ ã¾ã§è¡¨ç¤º",
            paginate: {
                first: "æœ€åˆ",
                last: "æœ€å¾Œ",
                next: "æ¬¡ã¸",
                previous: "å‰ã¸"
            },
            emptyTable: "ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“",
            zeroRecords: "ä¸€è‡´ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        }
    });
});
</script>

{% endblock %}
