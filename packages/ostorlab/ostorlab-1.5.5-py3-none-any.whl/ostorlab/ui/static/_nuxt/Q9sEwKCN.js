import{Y as E,c as ne,_ as ue}from"./CwXbrQOx.js";import{$ as re,a0 as ie,a1 as de,a2 as ce,a3 as pe,a4 as me,a5 as ve,a6 as fe,j as $,a7 as ge,a8 as Ve,a9 as R,aa as W,z as l,ab as M,d as ye,r as m,a as be,o as _e,H as Y,t as _,N as B,A as o,x as v,v as z,B as c,y as p,ac as H,T as Ae,W as K,Z as w,P as Q,ad as D,Q as Z,Y as Se,ae as Ce,U as q,C as he,D as ke}from"./Bl2PtCmi.js";import{u as xe}from"./D1jDBoMW.js";import{u as Ge,V as we,b as Te,a as Fe}from"./BMk0wala.js";import{_ as Ie,V as Ue}from"./BrqYU--B.js";import{a as L,b as Pe,A as Ne}from"./3QTbVI3Y.js";import{V as J,a as Ee}from"./CvQdbTl1.js";import{_ as Be}from"./DlAUqK2U.js";const De=re({...ie(),...de(ce(),["inline"])},"VCheckbox"),X=pe()({name:"VCheckbox",inheritAttrs:!1,props:De(),emits:{"update:modelValue":s=>!0,"update:focused":s=>!0},setup(s,T){let{attrs:A,slots:n}=T;const f=me(s,"modelValue"),{isFocused:S,focus:C,blur:u}=ve(s),r=fe(),g=$(()=>s.id||`checkbox-${r}`);return ge(()=>{const[F,h]=Ve(A),i=R.filterProps(s),I=W.filterProps(s);return l(R,M({class:["v-checkbox",s.class]},F,i,{modelValue:f.value,"onUpdate:modelValue":V=>f.value=V,id:g.value,focused:S.value,style:s.style}),{...n,default:V=>{let{id:y,messagesId:b,isDisabled:U,isReadonly:P,isValid:k}=V;return l(W,M(I,{id:y.value,"aria-describedby":b.value,disabled:U.value,readonly:P.value},h,{error:k.value===!1,modelValue:f.value,"onUpdate:modelValue":d=>f.value=d,onFocus:C,onBlur:u}),n)}})}),{}}}),Le=ne(ue),$e=s=>(he("data-v-5fbf6fc2"),s=s(),ke(),s),Me={class:"pb-5"},je={key:0,class:"mb-0"},Oe={key:1,class:"mb-0"},Re=$e(()=>v("span",{class:"headline"},"Create New Scanner",-1)),We={class:"d-flex align-center custom-option"},Ye={class:"d-flex align-center custom-option"},ze={class:"mb-4"},He="yaml",Ke=ye({__name:"AgentGroupForm",props:{agentGroup:{type:Object,default:()=>({id:"",key:"",name:"",description:"",agents:{agents:[]}})},isEditMode:{type:Boolean,default:!1},scanner:{type:Object,default:()=>({endpoint:"",name:"",apiKey:""})}},emits:["close-form"],setup(s,{emit:T}){const A={id:"",key:"",name:"",description:"",agents:{agents:[]}},n=s,f=m(),S=T,C=Ge(),u=m(A),r=m(""),g=Object.keys(L).map(t=>({title:L[t],icon:Pe[t]})),F=t=>t.toLowerCase().split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),h=Object.values(L).reduce((t,e)=>(t[e]=F(e),t),{}),i=m([]),I=t=>i.value.includes(t.title),V=t=>{if(t.title==="Select All"){b();return}const e=i.value.findIndex(N=>N===t.title);e===-1?i.value.push(t.value):i.value.splice(e,1)},y=$(()=>i.value.length===g.length),b=()=>{y.value===!0?i.value=[]:i.value=g.map(t=>t.title)},U={theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1},Placeholder:!0,PlaceholderText:"Start typing here"},{$axios:P}=be(),k=new Ne(P),d=m(null),j=m([]),x=m(!1);_e(()=>{r.value="",n.agentGroup!==null&&n.agentGroup!==void 0&&n.agentGroup.yamlSource!==null&&n.agentGroup.yamlSource!==void 0&&(r.value=n.agentGroup.yamlSource),n.scanner!==null&&n.scanner!==void 0&&(d.value=n.scanner)});const G=$(()=>d.value!=null&&r.value.trim()!==""),ee=t=>{const e=E.stringify(E.parse(t));if(e!=null)return e},te=async()=>{if(G.value===!0&&u.value!==null)try{const t=ee(r.value);if(d.value!==null&&t!==null&&t!==void 0){const e=E.parse(t);n.isEditMode==!0&&await k.deleteAgentGroup(d.value,parseInt(u.value.id)),await k.createAgentGroup({scanner:d.value,agentGroup:{description:u.value.description||"",agents:e==null?void 0:e.agents,name:u.value.name,assetTypes:i.value}})}O(),S("close-form"),C.reportSuccess("Agent group saved successfully.")}catch(t){C.reportError((t==null?void 0:t.message)||"Failed to save Agent group information. Please try again.")}},O=()=>{u.value=A,r.value="",d.value=null},ae=()=>{O(),S("close-form")},le=t=>{const e=(t.name||"").trim()!=="";return{title:e?t.name:t.endpoint,subtitle:e?t.endpoint:""}};Y(()=>n.agentGroup,t=>{var e;u.value={...t},r.value=((e=n.agentGroup)==null?void 0:e.yamlSource)||""},{immediate:!0,deep:!0}),Y(()=>r,t=>{r.value=t.value},{immediate:!0,deep:!0});const oe=xe();return j.value=oe.scanners||[],(t,e)=>{const N=Le;return _(),B(Ue,{ref_key:"form",ref:f,modelValue:G.value,"onUpdate:modelValue":e[8]||(e[8]=a=>G.value=a),onSubmit:D(te,["prevent"])},{default:o(()=>[v("div",Me,[l(J,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),items:j.value,"item-props":le,"hide-details":"",variant:"outlined","item-title":"endpoint",density:"compact",clearable:"","return-object":"",disabled:s.isEditMode,label:"Select a scanner",placeholder:"Select or create a scanner for the agent group"},{selection:o(({item:a})=>[(a.raw.name||"").trim()!==""?(_(),z("p",je,[c(p(a.raw.name)+" (",1),v("code",null,p(a.raw.endpoint),1),c(") ")])):(_(),z("code",Oe,p(a.raw.endpoint),1))]),"no-data":o(()=>[v("p",{class:"create-scanner mb-0 pl-4 py-0",onClick:e[0]||(e[0]=a=>x.value=!0)}," Create New Scanner ")]),_:1},8,["modelValue","items","disabled"]),l(Ee,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),persistent:"","max-width":"600px"},{default:o(()=>[l(we,null,{default:o(()=>[l(Te,null,{default:o(()=>[Re]),_:1}),l(Fe,null,{default:o(()=>[l(Ie,{onCloseForm:e[2]||(e[2]=a=>x.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l(H,{modelValue:u.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.name=a),variant:"outlined",density:"compact",label:"Agent Group Name",placeholder:"Agent Group Name"},null,8,["modelValue"]),l(H,{modelValue:u.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.description=a),variant:"outlined",density:"compact",label:"Agent Group Description",placeholder:"Agent Group Description"},null,8,["modelValue"]),l(J,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value=a),class:"mb-4",items:w(g),"hide-details":"",variant:"outlined",density:"compact",clearable:"",multiple:"",label:"Choose Asset Types",placeholder:"Choose Asset Types"},{selection:o(({item:a})=>[(_(),B(Ae,{key:a.value,variant:"outlined"},{default:o(()=>[l(K,{class:"ml-0",size:"18",start:""},{default:o(()=>[c(p(a.raw.icon),1)]),_:2},1024),c(" "+p(w(h)[a.title]),1)]),_:2},1024))]),"prepend-item":o(()=>[l(Q,{disabled:w(g).length===0,onClick:b},{default:o(()=>[v("div",We,[l(X,{"model-value":y.value,class:"mt-5",onClick:D(b,["stop"])},null,8,["model-value"]),l(Z,null,{default:o(()=>[c(p(y.value===!0?"Deselect All":"Select All"),1)]),_:1})])]),_:1},8,["disabled"]),l(Se)]),item:o(({item:a})=>[(_(),B(Q,M(a,{key:a.value,title:"",onClick:se=>V(a)}),{default:o(()=>[v("div",Ye,[l(X,{"model-value":I(a),class:"mt-5",onClick:D(se=>V(a),["stop"])},null,8,["model-value","onClick"]),l(K,null,{default:o(()=>[c(p(a.raw.icon),1)]),_:2},1024),l(Z,{class:"ml-3"},{default:o(()=>[c(p(w(h)[a.title]),1)]),_:2},1024)])]),_:2},1040,["onClick"]))]),_:1},8,["modelValue","items"]),v("div",ze,[l(Ce,null,{default:o(()=>[c(" Agent Group Definition ")]),_:1}),l(N,{modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value=a),lang:He,options:U,style:{"min-height":"300px"}},null,8,["modelValue"])]),l(q,{class:"me-2",type:"submit",color:"success",text:"Save","prepend-icon":"mdi-check",disabled:!G.value},null,8,["disabled"]),l(q,{text:"Cancel","prepend-icon":"mdi-close",onClick:ae})]),_:1},8,["modelValue"])}}}),lt=Be(Ke,[["__scopeId","data-v-5fbf6fc2"]]);export{lt as A};
