"use strict";(self.webpackChunkvdk_jupyterlab_extension=self.webpackChunkvdk_jupyterlab_extension||[]).push([[347],{347:(e,t,n)=>{n.r(t),n.d(t,{default:()=>re,workingDirectory:()=>le});var o,a=n(568),s=n(893),l=n.n(s);!function(e){e.NAME="jobName",e.TEAM="jobTeam",e.PATH="jobPath",e.ARGUMENTS="jobArguments",e.DEPLOYMENT_REASON="deploymentReason"}(o||(o={}));var r=n(977),i=new Map([]);function c(){for(const e of Object.values(o))i.set(e,"")}function u(){return{jobName:i.get(o.NAME),jobTeam:i.get(o.TEAM),jobPath:i.get(o.PATH),jobArguments:i.get(o.ARGUMENTS),deploymentReason:i.get(o.DEPLOYMENT_REASON)}}async function d(e){return!!i.get(e)||(await(0,r.showErrorMessage)("Encountered an error while trying to execute operation. Error:","The "+e+" should be defined!",[r.Dialog.okButton()]),!1)}c();var h=n(240);class m extends s.Component{constructor(){super(...arguments),this.state={inputWidth:250},this.inputRef=l().createRef(),this.onInputChange=e=>{this.props.onChange&&this.props.onChange(e);let t=e.currentTarget.value;t||(t=this.props.value),i.set(this.props.option,t)}}componentDidMount(){this.adjustInputWidth()}componentDidUpdate(e){e.value!==this.props.value&&this.adjustInputWidth()}adjustInputWidth(){const e=this.inputRef.current;if(!e)return;let t=250;const n=document.createElement("span");["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform"].forEach((t=>{const o=e?window.getComputedStyle(e).getPropertyValue(t):"";n.style[t]=o})),i.forEach((e=>{n.innerHTML=e,document.body.appendChild(n);const o=n.getBoundingClientRect().width+100;document.body.removeChild(n),t=Math.max(t,o)})),this.setState({inputWidth:t})}render(){return l().createElement("div",{className:"jp-vdk-input-wrapper"},l().createElement("label",{className:"jp-vdk-label",htmlFor:this.props.option},this.props.label,this.props.tooltip&&l().createElement("span",{className:"tooltip"},l().createElement(h.gZZ,{className:"icon-tooltip"}),l().createElement("span",{className:"tooltiptext"},this.props.tooltip))),l().createElement("input",{ref:this.inputRef,type:"text",id:this.props.option,className:"jp-vdk-input",placeholder:this.props.value,style:{width:`${this.state.inputWidth}px`},onChange:this.onInputChange}))}}var p=n(207),g=n(162);async function b(e="",t={}){const n=g.ServerConnection.makeSettings(),o=p.URLExt.join(n.baseUrl,"vdk-jupyterlab-extension",e);let a;try{a=await g.ServerConnection.makeRequest(o,t,n)}catch(e){throw e}let s=await a.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new Error(a.statusText);return s}const f=async e=>{await(0,r.showErrorMessage)("Encountered an error while trying to connect the server. Error:",e,[r.Dialog.okButton()])};function y(e){return e.substring(5,e.length-8)}const v=async(e,t=4320,n=1e4)=>{for(let o=0;o<t;o++){try{const t=await b(`taskStatus?taskId=${e}`,{method:"GET"});if(t.task_id===e&&"running"!==t.status)return"failed"===t.status&&f(t.error),t}catch(t){return f(t),{task_id:e,status:"failed",message:"",error:`An error occurred while polling for task status. Error: ${t}`}}await new Promise((e=>setTimeout(e,n)))}return{task_id:e,status:"failed",message:"",error:`Task ${e} timed out`}};async function E(){if(!await d(o.PATH))return{message:"",isSuccessful:!1};try{const e=await b("run",{body:JSON.stringify(u()),method:"POST"});if(e.error)return f(e.error),{message:e.message,isSuccessful:!1};const t=y(e.message),n=await v(t);return n.error?{message:n.error,isSuccessful:!1}:{message:n.message,isSuccessful:!0}}catch(e){return f(e),{message:"",isSuccessful:!1}}}async function w(e){if(await d(o.NAME)&&await d(o.TEAM))try{const t=await b(e,{body:JSON.stringify(u()),method:"POST"});if(t.error)return f(t.error),{message:t.message,isSuccessful:!1};const n=y(t.message),o=await v(n);return o.error?{message:o.error,isSuccessful:!1}:{message:o.message,isSuccessful:!0}}catch(e){return f(e),{message:"",isSuccessful:!1}}return{message:"",isSuccessful:!1}}var k=n(666);const j="Convert Job To Notebook",N="Run Job",T="Status",A="jp-vdk:check-status-button",S="Error",D="vdk_run.log";async function C(e){const{title:t,messages:n,error:o,buttons:a=[r.Dialog.okButton({label:"OK"})]}=e;return await(0,r.showDialog)({title:t,body:l().createElement("div",{className:"vdk-error-dialog"},l().createElement(k.closeIcon.react,{className:"vdk-dialog-error-icon"}),l().createElement("div",null,n.map(((e,t)=>l().createElement("p",{key:t},e)))," ",o&&l().createElement("p",null,o))),buttons:a})}class P{constructor(e){this.exception_message="",this.what_happened="",this.why_it_happened="",this.consequences="",this.countermeasures="",this.__parse_message(e)}__parse_message(e){const t=["exception_message","what_happened","why_it_happened","consequences","countermeasures"],n=["ERROR : ","WHAT HAPPENED :","WHY IT HAPPENED :","CONSEQUENCES :","COUNTERMEASURES :"],o=e.split("\n");let a=0;for(let s=0;s<o.length;s++){const l=o[s].indexOf(n[a]);if(-1!==l){if(this[t[a]]=n[a]+o[s].substring(l+n[a].length),a++,a===t.length)break}else this.exception_message=e}}}class _ extends s.Component{constructor(e){super(e),this._onArgsChange=e=>{let t=e.currentTarget.value;t&&this._isJSON(t)&&i.set(o.ARGUMENTS,t)},this._isJSON=e=>{try{return JSON.parse(e),!0}catch(e){return!1}}}render(){return l().createElement(l().Fragment,null,l().createElement(m,{option:o.PATH,value:this.props.jobPath,label:"Path to job directory:"}),l().createElement(m,{option:o.ARGUMENTS,value:'{"key": "value"}',label:"Arguments:",onChange:this._onArgsChange}))}}async function x(e,t){if((await(0,r.showDialog)({title:N,body:l().createElement(_,{jobPath:i.get(o.PATH)}),buttons:[r.Dialog.okButton(),r.Dialog.cancelButton()]})).button.accept){null==t||t.show("Run",i.get(o.PATH)),null==e||e.closeFile(D);let{message:n,isSuccessful:a}=await E();if(null==e||e.confirmClosingDocument,a)(0,r.showDialog)({title:N,body:l().createElement("div",{className:"vdk-run-dialog-message-container"},l().createElement(k.checkIcon.react,{className:"vdk-dialog-check-icon"}),l().createElement("p",{className:"vdk-run-dialog-message"},"The job was executed successfully!")),buttons:[r.Dialog.okButton()]}),null==e||e.open(D);else{null==e||e.open(D),n="ERROR : "+n;const t=new P(n);e&&await M(t,e)||await C({title:N,messages:[t.exception_message,t.what_happened,t.why_it_happened,t.consequences,t.countermeasures]})}}}const I=e=>{const t=e.getElementsByClassName("jp-Cell-inputWrapper");for(let e=0;e<t.length;e++){const n=t[e].getElementsByClassName("jp-Cell-inputArea");if(n.length>0){const e=n[0].getElementsByClassName("jp-InputArea-prompt");if(e.length>0)return e[0]}}},O=e=>{const t=I(e);null==t||t.classList.add("jp-vdk-failing-cell-prompt"),e.scrollIntoView(),e.classList.add("jp-vdk-failing-cell"),Array.from(document.getElementsByClassName("jp-vdk-failing-cell-num")).forEach((e=>{e.classList.remove("jp-vdk-failing-cell-num"),e.classList.add("jp-vdk-cell-num")}))},R=e=>{e.classList.remove("jp-vdk-failing-cell");const t=I(e);null==t||t.classList.remove("jp-vdk-failing-cell-prompt")},M=async(e,t)=>{const n=(e=>{const t=e.match(/cell_id:([0-9a-fA-F-]+)/);return t?t[1]:""})(e.what_happened);if(n){const{path:a,cellIndex:s}=await async function(e){const t={cellId:e,jobPath:i.get(o.PATH)};if(!await d(o.PATH))return{path:"",cellIndex:""};try{const e=await b("notebook",{body:JSON.stringify(t),method:"POST"});return{path:e.path,cellIndex:e.cellIndex}}catch(e){return{path:"",cellIndex:""}}}(n);if(a){const n=async()=>{const e=t.openOrReveal(a);if(e){await e.revealed;const t=Array.from(e.node.children);t&&t.forEach((async e=>{e.classList.contains("jp-Notebook")&&(async(e,t,n)=>{const o=e.children;if(t>o.length)(0,r.showDialog)({title:"Run Failed",body:l().createElement("div",null,l().createElement("p",null,"Sorry, something went wrong while trying to find the failing cell!"),l().createElement("p",null,"Please, check the ",n," once more and try to run the job while the notebook is active!")),buttons:[r.Dialog.cancelButton()]});else for(let e=0;e<o.length;e++)e===t?O(o[e]):R(o[e])})(e,Number(s),a)}))}};return(await C({title:N,messages:[e.exception_message,e.what_happened,e.why_it_happened,e.consequences,e.countermeasures],buttons:[r.Dialog.okButton({label:"See failing cell"}),r.Dialog.cancelButton()]})).button.accept&&await n(),!0}}return!1};class L extends s.Component{render(){return l().createElement("div",null,l().createElement("input",{type:"checkbox",id:this.props.id,className:"jp-vdk-checkbox",onChange:e=>this.props.onChange(e.target.checked),defaultChecked:this.props.checked}),l().createElement("label",{className:"checkboxLabel",htmlFor:this.props.id},this.props.label))}}class W extends s.Component{constructor(e){super(e)}render(){return l().createElement(l().Fragment,null,l().createElement(m,{option:o.NAME,value:this.props.jobName,label:"Job Name:"}),l().createElement(m,{option:o.TEAM,value:this.props.jobTeam,label:"Job Team:"}),l().createElement(m,{option:o.PATH,value:this.props.jobPath,label:"Path to job directory:"}),l().createElement(m,{option:o.DEPLOYMENT_REASON,value:"",label:"Deployment reason:"}))}}async function H(e,t){let n=!0;const a=await(0,r.showDialog)({title:"Create Deployment",body:l().createElement(l().Fragment,null,l().createElement(W,{jobName:i.get(o.NAME)||"",jobPath:i.get(o.PATH)||"",jobTeam:i.get(o.TEAM)||""}),l().createElement(L,{checked:!0,onChange:e=>n=e,label:"Run data job before deployment",id:"deployRun"})),buttons:[r.Dialog.okButton(),r.Dialog.cancelButton()]});if(!a.value&&a.button.accept&&await d(o.DEPLOYMENT_REASON))try{if(null==t||t.show("Deploy",i.get(o.PATH)),n){null==e||e.closeFile(D);const t=await E();if(t.isSuccessful){const e=await w("deploy");e.isSuccessful&&e.message&&alert("The test job run completed successfully! \n"+e.message)}else{const e=new P("ERROR : "+t.message);(0,r.showDialog)({title:N,body:l().createElement("div",{className:"vdk-run-error-message "},l().createElement("p",null,e.exception_message),l().createElement("p",null,e.what_happened),l().createElement("p",null,e.why_it_happened),l().createElement("p",null,e.consequences),l().createElement("p",null,e.countermeasures)),buttons:[r.Dialog.okButton()]})}null==e||e.open(D)}else{const e=await w("deploy");e.isSuccessful&&e.message&&alert(e.message)}}catch(e){await(0,r.showErrorMessage)("Encountered an error when deploying the job. Error:",e,[r.Dialog.okButton()])}}class J extends s.Component{constructor(e){super(e)}render(){return l().createElement(l().Fragment,null,l().createElement(m,{option:o.NAME,value:this.props.jobName,label:"Job Name:"}),l().createElement(m,{option:o.TEAM,value:this.props.jobTeam,label:"Job Team:"}),l().createElement(m,{option:o.PATH,value:this.props.jobPath,label:"Path to job directory:",tooltip:"Specify the directory for the new job folder, e.g., 'x/y' with job name 'foo' becomes 'x/y/foo'. If left blank, it defaults to the Jupyter's main directory."}))}}async function K(e){if(i.set(o.PATH,""),(await(0,r.showDialog)({title:"Create Job",body:l().createElement(J,{jobPath:i.get(o.PATH),jobName:i.get(o.NAME),jobTeam:i.get(o.TEAM)}),buttons:[r.Dialog.okButton(),r.Dialog.cancelButton()]})).button.accept){e.show("Create",i.get(o.PATH));const t=await w("create");t.isSuccessful&&t.message&&alert(t.message)}}class V extends s.Component{constructor(e){super(e)}render(){return l().createElement(l().Fragment,null,l().createElement(m,{option:o.NAME,value:"default-name",label:"Job Name:"}),l().createElement(m,{option:o.TEAM,value:"default-team",label:"Job Team:"}),l().createElement(m,{option:o.PATH,value:this.props.jobPath,label:"Path to job directory:",tooltip:"Specify the directory for the new job folder, e.g., 'x/y' with job name 'foo' becomes 'x/y/foo'. If left blank, it defaults to the Jupyter's main directory."}))}}async function B(e){if(i.set(o.PATH,""),(await(0,r.showDialog)({title:"Download Job",body:l().createElement(V,{jobPath:i.get(o.PATH)}),buttons:[r.Dialog.okButton(),r.Dialog.cancelButton()]})).button.accept){null==e||e.show("Download",i.get(o.PATH));const t=await w("download");t.isSuccessful&&t.message&&alert(t.message)}}var U;class F extends s.Component{constructor(e){super(e)}render(){return l().createElement(l().Fragment,null,l().createElement(m,{option:o.PATH,value:this.props.jobPath,label:"Path to job directory:"}))}}async function q(e,t,n,a){if((await(0,r.showDialog)({title:j,body:l().createElement(F,{jobPath:i.get(o.PATH)}),buttons:[r.Dialog.okButton(),r.Dialog.cancelButton()]})).button.accept&&(await(0,r.showDialog)({title:j,body:l().createElement("p",null,"Are you sure you want to convert the Data Job with path:"," ",l().createElement("i",null,i.get(o.PATH))," to notebook?"),buttons:[r.Dialog.okButton(),r.Dialog.cancelButton()]})).button.accept){null==a||a.show("Convert",i.get(o.PATH));let{message:s,isSuccessful:c}=await async function(){if(!await d(o.PATH))return{message:"The job path is not defined. Please define it before attempting to convert the job to a notebook.",isSuccessful:!1};try{const e=await b("convertJobToNotebook",{body:JSON.stringify(u()),method:"POST"});if(e.error)return f(e.error),{message:e.message,isSuccessful:!1};const t=y(e.message),n=await v(t);return n.error?{message:n.error,isSuccessful:!1}:{message:n.message,isSuccessful:!0}}catch(e){return f(e),{message:"",isSuccessful:!1}}}();if(c&&"string"!=typeof s)U=G(s.code_structure,s.removed_files),await Y(e,t,n),await(0,r.showDialog)({title:j,body:l().createElement("div",{className:"vdk-convert-to-notebook-dialog-message-container"},l().createElement(k.checkIcon.react,{className:"vdk-dialog-check-icon"}),l().createElement("p",{className:"vdk-convert-to-notebook-dialog-message"},"The Data Job with path ",l().createElement("i",null,i.get(o.PATH))," was converted to notebook successfully!")),buttons:[r.Dialog.okButton()]});else if(s){s="ERROR : "+s;const e=new P(s);await C({title:j,messages:[e.exception_message,e.what_happened,e.why_it_happened,e.consequences,e.countermeasures]})}}}const Y=async(e,t,n)=>{try{const n=await async function(){return await b("serverPath",{method:"GET"})||(await(0,r.showErrorMessage)("Encountered an error while trying to connect the server. Error:       the server's location cannot be identified!",[r.Dialog.okButton()]),"")}();i.set(o.NAME,i.get(o.PATH).split(/[\\/]/).pop()||""),await t.model.cd(i.get(o.PATH).substring(n.length)),e.execute("notebook:create-new")}catch(e){await C({title:j,messages:["Something went wrong while trying to create the new transformed notebook. Error:"],error:e})}},G=(e,t)=>{const n=[];for(let o=0;o<e.length;o++)n.push({source:"#### "+t[o],type:"markdown"}),n.push({source:e[o],type:"code"}),e[o].includes("def run(job_input: IJobInput)")&&n.push({source:"run(job_input)",type:"code"});return n};var z;!function(e){e[e.NONE=0]="NONE",e[e.WINDOW_OPENED=1]="WINDOW_OPENED",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"}(z||(z={}));class $ extends s.Component{constructor(e){super(e),this.authWindow=null,this.openAuthWindow=async()=>{try{const e=await b("login",{method:"GET"});console.debug("Authorization redirect URL is"+e),this.authWindow=window.open(e,"authWindow","width=600,height=400"),this.setState({authStatus:z.WINDOW_OPENED})}catch(e){console.error("Error during start of authentication:",e),this.setState({authStatus:z.FAILURE})}},this.closeAuthWindow=()=>{this.authWindow&&!this.authWindow.closed&&this.authWindow.close()},this.handleURLInput=async e=>{const t=e.target.value,n=new URL(t).searchParams.get("code");if(n)try{await b("login?code="+n,{method:"GET"}),this.closeAuthWindow(),this.setState({authStatus:z.SUCCESS})}catch(e){this.closeAuthWindow(),console.error("Error during authentication:",e),this.setState({authStatus:z.FAILURE})}},this.state={authStatus:z.NONE}}render(){return l().createElement("div",{className:"jp-vdk-login2-dialog-container"},this.state.authStatus===z.NONE&&l().createElement("div",null,l().createElement("p",null,"Authenticate process will start. After you clik a new window will be opened."),l().createElement("ul",null,l().createElement("li",null,"Please ",l().createElement("b",null,"wait")," for the authentication window to redirect you back to 127.0.0.1."),l().createElement("li",null,l().createElement("b",null,"Ignore")," the failed connection error message."),l().createElement("li",null,"And then ",l().createElement("b",null,"copy and paste")," the full URL you are redirected to.")),l().createElement("button",{className:"jp-vdk-login2-button",onClick:this.openAuthWindow},"Click here to start.")),this.state.authStatus===z.WINDOW_OPENED&&l().createElement("div",null,l().createElement("p",null,"A new authentication window has been opened."),l().createElement("ul",null,l().createElement("li",null,"Please ",l().createElement("b",null,"wait")," for the authentication window to redirect you back to 127.0.0.1."),l().createElement("li",null,l().createElement("b",null,"Ignore")," the failed connection error message."),l().createElement("li",null,"And then ",l().createElement("b",null,"copy and paste")," the full URL you are redirected to in here:")),l().createElement("input",{type:"text",className:"jp-vdk-login2-input",onChange:this.handleURLInput})),this.state.authStatus===z.SUCCESS&&l().createElement("div",null,l().createElement("p",null,"Authentication successful!")),this.state.authStatus===z.FAILURE&&l().createElement("div",null,l().createElement("p",null,"Authentication failed!")))}}async function Z(){await(0,r.showDialog)({title:"Login into VDK Control Service",body:l().createElement($,null),buttons:[r.Dialog.cancelButton({label:"Close"})],hasClose:!1})}var Q="";function X(e,t,n,a,s,l,r,d,h){e.addCommand(t,{label:n,caption:a,execute:async()=>{try{Q?await C({title:S,messages:["Another VDK operation is currently running!","Please wait until the operation ends!"]}):(Q=t,i.set(o.PATH,le),await async function(){try{const e=await b("job",{body:JSON.stringify(JSON.stringify(u())),method:"POST"});e&&(i.set(o.NAME,e[o.NAME]),i.set(o.TEAM,e[o.TEAM]),i.set(o.PATH,e[o.PATH]))}catch(e){f(e)}}(),"Convert Job To Notebook"===n?await s(e,d,h,l):r?await s(r,l):await s(l),l.hide(),c(),Q="")}catch(e){await C({title:S,messages:["Encountered an error when trying to open the dialog. Error:"],error:e})}}})}var ee=n(851),te=n(278);const ne=(e,t)=>{const n=document.createElement("div");n.innerText=String(e),t.classList.contains("jp-vdk-failing-cell")?n.classList.add("jp-vdk-failing-cell-num"):n.classList.add("jp-vdk-cell-num"),t.appendChild(n)},oe=e=>{const t=document.createElement("img");t.setAttribute("src","https://raw.githubusercontent.com/vmware/versatile-data-kit/dc15f7489f763a0e0e29370b2e06a714448fc234/support/images/versatile-data-kit-logo.svg"),t.setAttribute("width","20"),t.setAttribute("height","20"),t.classList.add("jp-vdk-logo"),e.appendChild(t)};var ae=n(838);class se{constructor(e){this.buttonElement=document.createElement("button"),this.buttonElement.id="jp-vdk-check-status-button",this.buttonElement.className="jp-vdk-check-status-button";const t=document.createElement("div");t.className="jp-vdk-status-button-content",oe(t);const n=document.createElement("span");n.innerHTML="00:00:00",t.appendChild(n),this.buttonElement.appendChild(t),this.commands=e,this.buttonElement.onclick=()=>{e.execute(A,{operation:this.operation,path:this.jobPath})},this.buttonElement.title="VDK operation is in progress. Click here for more info.",this.buttonElement.style.display="none",this.counter=0}get element(){return this.buttonElement}show(e,t){this.operation=e,this.jobPath=t,this.buttonElement.style.display="",this.startTimer(),this.commands.execute(A,{operation:this.operation,path:this.jobPath})}hide(){this.buttonElement.style.display="none",this.stopTimer()}startTimer(){this.counter=0,this.timerId=window.setInterval((()=>{this.counter++;const e=this.buttonElement.querySelector("span");var t;e&&(e.innerHTML=`${t=this.counter,new Date(1e3*t).toISOString().substr(11,8)}`)}),1e3)}stopTimer(){this.timerId&&(clearInterval(this.timerId),this.timerId=void 0);const e=this.buttonElement.querySelector("span");e&&(e.innerHTML="00:00:00")}}let le="";const re={id:"vdk-jupyterlab-extension:plugin",autoStart:!0,optional:[a.ISettingRegistry,ee.IFileBrowserFactory,te.INotebookTracker,r.IThemeManager,ae.IDocumentManager],activate:async(e,t,n,a,s,c)=>{const{commands:u}=e;a.activeCellChanged.connect(((e,t)=>{"jp-vdk:menu-convert-job-to-notebook"!==Q?function(e){var t,n,o,a,s,l,r;const i=e.currentWidget;if(i){const e=null===(n=null===(t=i.content.model)||void 0===t?void 0:t.contentFactory)||void 0===n?void 0:n.createMarkdownCell({cell:{cell_type:"markdown",source:["You are running in environment where VDK Jupyter extension is installed.<br/>","If you are not using VDK, you can delete and ignore this and below cell.<br/><br/>","To learn more check out [VDK Notebook Getting Started](https://bit.ly/vdk-notebook).<br/><br/>","**IMPORTANT: Please execute the cell below to load the VDK job_input variable.**"],metadata:{editable:!1}}}),c=null===(a=null===(o=i.content.model)||void 0===o?void 0:o.contentFactory)||void 0===a?void 0:a.createCodeCell({cell:{cell_type:"code",source:['"""\n',"vdk.plugin.ipython extension introduces a magic command for Jupyter.\n","The command enables the user to load VDK for the current notebook.\n","VDK provides the job_input API, which has methods for:\n","    * executing queries to an OLAP database;\n","    * ingesting data into a database;\n","    * processing data into a database.\n","Type help(job_input) to see its documentation.\n\n",'"""\n',"%reload_ext vdk.plugin.ipython\n","%reload_VDK\n","job_input = VDK.get_initialized_job_input()"],metadata:{editable:!1}}}),u=null===(l=null===(s=i.content.model)||void 0===s?void 0:s.contentFactory)||void 0===l?void 0:l.createCodeCell({cell:{cell_type:"code",source:[],metadata:{tags:["vdk"]}}}),d=null===(r=i.content.model)||void 0===r?void 0:r.cells,h=null==d?void 0:d.get(0).value.text;d&&e&&c&&u&&d.length<=1&&""===h&&(d.insert(0,e),d.insert(1,c),d.insert(2,u),d.remove(3))}}(a):(async e=>{var t,n;const a=e.currentWidget;if(a){const s=null===(n=null===(t=e.currentWidget)||void 0===t?void 0:t.content.model)||void 0===n?void 0:n.cells,l=null==s?void 0:s.get(0).value.text;if(s&&s.length<=1&&""==l){s.remove(1);const e=e=>{var t,n;const o=null===(n=null===(t=a.content.model)||void 0===t?void 0:t.contentFactory)||void 0===n?void 0:n.createMarkdownCell({cell:{cell_type:"markdown",source:e,metadata:{}}});o&&s.push(o)},t=(e,t)=>{var n,o;const l=null===(o=null===(n=a.content.model)||void 0===n?void 0:n.contentFactory)||void 0===o?void 0:o.createCodeCell({cell:{cell_type:"code",source:e,metadata:t}});l&&s.push(l)};e(["# "+i.get(o.NAME)]),e(["### Please go through this guide before continuing with the data job run and development."]),e(["#### Introduction and Preparations\n","*  *This is a notebook transformed from a directory style data job located in "+i.get(o.PATH)+".*\n","*  *If you are not familiar with notebook data jobs make sure to check the [Getting Started](https://github.com/vmware/versatile-data-kit/blob/main/projects/vdk-plugins/vdk-jupyter/getting-started.ipynb) page.*\n","*  *You can find an archive of the **original job** at "+i.get(o.PATH).split(/[/\\]/).slice(0,-1).join("/")+".*"]),e(["#### What happened to my Data Job?\n","\n","<p> The Data Job's cells are automatically generated corresponding to VDK steps in the original files </p>\n","\n","<i>\n","<details><summary>Click to learn more</summary> \n","    <ul>\n","        <li> The below cells are automatically generated corresponding to a step (.sql file or .py file with VDK run(job_input) function) in your original job.</li>\n",'        <li> When you see a title saying <b>"Step generated from: sample.py"</b> before some blocks of code, \n','        it means that the code below that title was created from the "sample.py" file.</li>\n','        <li> Similarly, if you come across code cells that start <b>%%vdksql</b> contain code generated from ".sql" steps.</li>\n','        <li> On the other hand, code cells originating from ".py" files remain unchanged.\n','        However, an additional cell is included that calls the "run" function using the command <b>"run(job_input)"</b> . \n','            This cell executes the "run" function from the code generated from the ".py" file.</li>\n','        <li> ".py" files that are not considered a step - without VDK run(job_input) function - remain as files unchanged.</li>\n',"    </ul>\n","</details>\n","</i>"]),e(["#### What are those numbers with VDK Logo next to them?\n","\n","<p>They identify a <b>VDK cell</b>.<br/> <b>VDK cells</b> would be executed, in the specified order, when the data job is either deployed and subsequently executed with <b>VDK run</b>, or locally executed with <b>VDK run</b>.</p>\n","<i>\n","<details><summary>Click to learn more</summary>\n","    <ul>\n","        <li>You will notice that some cells are coloured and include the VDK logo and a numbering. \n",'            These are the "vdk" tagged cells. They have special meaning when using VDK run command.</li>\n','        <li>You can mark a cell as <b>VDK cell</b> by setting the "vdk" tag on the cell. And removing it as a vdk cell step by removing the "vdk" tag.\n',"        <li>Only these cells are executed during VDK run command and all the others are ignored (for example the current cell). </li>\n","        <li>The cells in the notebook will be executed according to the numbering when running the notebook data job with VDK Run. This means that the steps in the job are organized from the top to the bottom, starting with the first step.</li>\n",'        <li>You can delete the cells that are not tagged with "vdk" as they are not essential to the data job\'s execution.\n',"            However, removing tagged cells will result in a different data job run.</li>\n","    </ul> \n","</details>\n","</i>\n","<br/>"]),t(['"""\n',"vdk.plugin.ipython extension introduces a magic command for Jupyter.\n","The command enables the user to load VDK for the current notebook.\n","VDK provides the job_input API, which has methods for:\n","    * executing queries to an OLAP database;\n","    * ingesting data into a database;\n","    * processing data into a database.\n","See the IJobInput documentation for more details.\n","https://github.com/vmware/versatile-data-kit/blob/main/projects/vdk-core/src/vdk/api/job_input.py\n","Please refrain from tagging this cell with VDK as it is not an actual part of the data job\n","and is only used for development purposes.\n",'"""\n',"%reload_ext vdk.plugin.ipython\n","%reload_VDK\n","job_input = VDK.get_initialized_job_input()"],{});for(const n of U)"markdown"===n.type?e([n.source]):"code"===n.type&&(t([n.source],{tags:["vdk"]}),t(["run(job_input)"],{tags:["vdk"]}));U=[]}}})(a)})),function(e){e.addCommand(A,{label:T,icon:k.checkIcon,execute:async e=>{const t=e.operation||"UNKNOWN",n=e.path||"UNKNOWN";await(0,r.showDialog)({title:T,body:l().createElement("div",{className:"vdk-status-dialog-message-container"},l().createElement("p",{className:"vdk-status-dialog-message"},l().createElement("b",null,t)," operation is currently running for job with path: ",l().createElement("i",null,n),"!",l().createElement("br",null)),l().createElement("p",{className:"vdk-status-dialog-message-little"},"You can close this dialog and follow the operation using the status button in the upper right corner.")),buttons:[r.Dialog.okButton()]})}})}(u);const d=function(e){return new se(e)}(u),h=n.defaultBrowser;e.restored.then((()=>{const e=document.querySelector("#jp-top-panel");e&&e.appendChild(d.element)})),function(e,t,n,o,a){e.addCommand("jp-vdk:menu-login",{label:"Login",caption:"Execute VDK Login Command",execute:Z}),X(e,"jp-vdk:menu-run","Run","Execute VDK Run Command",x,a,t),X(e,"jp-vdk:menu-create","Create","Execute VDK Create Command",K,a),X(e,"jp-vdk:menu-download","Download","Execute VDK Download Command",B,a),X(e,"jp-vdk:menu-convert-job-to-notebook","Convert Job To Notebook","Convert Data Job To Jupyter Notebook",q,a,void 0,n,o),X(e,"jp-vdk:menu-create-deployment","Deploy","Create deployment of a VDK job",H,a,t)}(u,c,h,a,d),h.model.pathChanged.connect(ie),((e,t)=>{const n=async()=>{if(e.currentWidget&&e.currentWidget.model&&0!==e.currentWidget.model.cells.length){let n=[],o=0;for(;e.currentWidget&&e.currentWidget.model&&e.currentWidget.model.cells.get(o);){const t=e.currentWidget.model.cells.get(o).metadata.get("tags");t&&t.includes("vdk")&&n.push(o),o++}n.length||(n=await async function(e){try{const t={nbPath:e};return await b("vdkCellIndices",{body:JSON.stringify(t),method:"POST"})}catch(e){f(e)}return[]}(e.currentWidget.context.path)),n.length>0&&e.activeCell&&e.activeCell.parent&&e.activeCell.parent.node.children&&((e,t,n,o)=>{Array.from(document.getElementsByClassName("jp-vdk-cell-num")).forEach((e=>{e.remove()})),Array.from(document.getElementsByClassName("jp-vdk-failing-cell-num")).forEach((e=>{e.remove()})),Array.from(document.getElementsByClassName("jp-vdk-logo")).forEach((e=>{e.remove()}));let a=0;for(let s=0;s<e.length;s++)t.includes(s)?(n.theme&&n.isLight(n.theme.toString())?(e[s].classList.remove("jp-vdk-cell-dark"),e[s].classList.add("jp-vdk-cell")):(e[s].classList.add("jp-vdk-cell"),e[s].classList.add("jp-vdk-cell-dark")),o&&e[s]!=o&&oe(e[s]),ne(++a,e[s])):(e[s].classList.remove("jp-vdk-cell"),e[s].classList.remove("jp-vdk-cell-dark"))})(Array.from(e.activeCell.parent.node.children),n,t,e.activeCell.node)}};e.activeCellChanged.connect(n),t.themeChanged.connect(n)})(a,s)}},ie=async(e,t)=>{le=t.newValue}}}]);