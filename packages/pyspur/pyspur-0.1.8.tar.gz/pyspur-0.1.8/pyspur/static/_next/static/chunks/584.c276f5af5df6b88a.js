"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[584],{68584:(e,l,o)=>{o.r(l),o.d(l,{default:()=>V});var t=o(74848),n=o(7651),a=o(31024),d=o(72748),r=o(37399),i=o(87947),s=o(53692);o(69703);var c=o(88781),u=o(7350),h=o.n(u),w=o(2404),f=o.n(w),g=o(96540),b=o(71468),k=o(52136),p=o(5266),m=o(29838),v=o(53212),x=o(84994),C=o(95258),y=o(38947),E=o(40851),j=(o(33596),o(48850)),S=o(52153),N=o(46421),I=o(43346),D=o(80893),A=o(36240);let L={custom:D.A},z=e=>{let{workflowData:l,workflowID:o,onDownloadImageInit:u}=e,w=(0,b.wA)(),E=(0,b.d4)(e=>e.flow.projectName),[D,z]=(0,g.useState)(400),[V,T]=(0,g.useState)(!1),[M,B]=(0,g.useState)(!0),_=(0,g.useRef)(null),H=(0,b.d4)(e=>e.nodeTypes.data),{nodeTypes:K,isLoading:P}=(0,C.Tj)({nodeTypesConfig:H,readOnly:!1,includeCoalesceNode:!0});(0,g.useEffect)(()=>{l&&w((0,m.R$)({nodeTypes:H,definition:l.definition,workflowID:o,name:l.name}))},[w,l,o,H]);let Q=(0,b.d4)(e=>e.flow.nodes,f()),R=(0,b.d4)(e=>e.flow.edges,f()),F=(0,b.d4)(e=>e.flow.nodeConfigs,f()),Z=(0,b.d4)(e=>e.flow.selectedNode),q=(0,b.d4)(e=>e.flow.selectedEdgeId),W=(0,p.y)();(0,g.useEffect)(()=>{(Q.length>0||R.length>0||Object.keys(F).length>0)&&W()},[Q,R,F,W]);let[G,U]=(0,g.useState)(null),[Y,$]=(0,g.useState)({horizontal:null,vertical:null}),[J,X]=(0,g.useState)(null),[ee,el]=(0,g.useState)(null),[eo,et]=(0,g.useState)(!1),[en,ea]=(0,g.useState)(null),[ed,er]=(0,g.useState)({x:0,y:0}),ei=(0,v.y)(e=>e.mode),{getIntersectingNodes:es,getNodes:ec,updateNode:eu}=(0,i.VH)(),eh=(0,g.useCallback)(e=>{let{sourceNode:l,targetNode:o,edgeId:t}=e;if(!G)return;let n=(l.position.x+o.position.x)/2,a=(l.position.y+o.position.y)/2,d=G.flowToScreenPosition({x:n,y:a});er({x:d.x,y:d.y}),ea({sourceNode:l,targetNode:o,edgeId:t}),et(!0)},[G]),{onNodesChange:ew,onEdgesChange:ef,onConnect:eg,onNodeDragStop:eb}=(0,C.dW)({dispatch:w,nodes:Q,setHelperLines:$}),ek=(0,C.Bf)({edges:R,hoveredNode:J,hoveredEdge:ee,selectedEdgeId:q,handlePopoverOpen:eh}),ep=(0,C.ml)({nodes:Q,mode:ei}),em=(0,C.Fu)({nodes:ep}),ev=(0,g.useCallback)((e,l)=>{el(l.id)},[el]),ex=(0,g.useCallback)(()=>{el(null)},[el]),eC=(0,g.useCallback)(e=>{U(e),e.setViewport({x:0,y:0,zoom:.8})},[]),ey=(0,g.useCallback)((e,l)=>{w((0,m.Qi)({nodeId:l.id}))},[w]),eE=(0,g.useCallback)((e,l)=>{w((0,m.Yy)({edgeId:l.id}))},[w]),ej=(0,g.useCallback)(()=>{Z&&w((0,m.Qi)({nodeId:null})),q&&w((0,m.Yy)({edgeId:null})),w((0,x.iv)(!1))},[w,Z,q]),eS=(0,g.useCallback)(e=>{e.forEach(e=>{w((0,m.AC)({nodeId:e.id})),Z===e.id&&w((0,m.Qi)({nodeId:null}))})},[w,Z]),eN=(0,g.useCallback)(e=>{let l=e.target,o=l.tagName.toLowerCase();if(l.isContentEditable||"input"===o||"textarea"===o||"select"===o)return;let t=document.querySelector(".h-full.bg-background.dark\\:bg-background\\/80.border-l.border-divider");if(null==t?void 0:t.contains(document.activeElement))return;let n=document.querySelector("[data-node-panel]"),a=(null==n?void 0:n.getAttribute("data-expanded"))==="true",d=null==n?void 0:n.contains(document.activeElement);if("Delete"===e.key||"Backspace"===e.key){let e=Q.filter(e=>e.selected);e.length>0&&eS(e);return}if(a&&d)return;let r=e.shiftKey?45:15;if(G){let{x:l,y:o,zoom:t}=G.getViewport();switch(e.key){case"ArrowLeft":G.setViewport({x:l+r,y:o,zoom:t});break;case"ArrowRight":G.setViewport({x:l-r,y:o,zoom:t});break;case"ArrowUp":G.setViewport({x:l,y:o+r,zoom:t});break;case"ArrowDown":G.setViewport({x:l,y:o-r,zoom:t})}}},[Q,eS,G]),eI=(0,g.useCallback)(()=>{let e=(0,n.B)(Q,R);w((0,m.CU)({nodes:e}))},[Q,R,w]);(0,g.useEffect)(()=>(window.addEventListener("keydown",eN),()=>{window.removeEventListener("keydown",eN)}),[eN]),(0,k.K)(Z,Q,K,H,w,eI);let{cut:eD,copy:eA,paste:eL,bufferedNodes:ez}=(0,y.A)();(0,y.A)();let eO=(0,g.useCallback)((e,l)=>{X(l.id)},[X]),eV=(0,g.useCallback)(()=>{X(null)},[X]);(0,g.useCallback)((e,l,o,t)=>{(0,C.HB)(Q,H,e,l,o,t,w,()=>et(!1))},[Q,H,w,et]);let eT=(0,g.useCallback)(h()((e,l)=>{(0,N.tJ)(e,l,Q,w,es,ec,eu)},16),[Q,w,es]),eM=(0,g.useCallback)((e,l)=>{(0,N.Lm)(e,l,Q,R,w,es,ec,eu),eb(e,l)},[Q,R,w,es,ec,eu,eb]),eB=(0,g.useCallback)(()=>{let e=document.querySelector(".react-flow__viewport");e&&(0,c.$E)(e,{backgroundColor:"transparent",width:e.clientWidth,height:e.clientHeight}).then(e=>{let l=document.createElement("a");l.href=e,l.download="".concat(E,".png"),l.click()}).catch(e=>{console.error("Failed to download image",e)})},[E]);(0,g.useEffect)(()=>{u&&u(eB)},[eB,u]);let e_=(0,g.useCallback)(e=>{T(!0),e.preventDefault()},[]),eH=(0,g.useCallback)(()=>{T(!1)},[]),eK=(0,g.useCallback)(e=>{if(V&&_.current){let l=_.current.getBoundingClientRect(),o=l.right-e.clientX;o>200&&o<.8*l.width&&z(o)}},[V]);return((0,g.useEffect)(()=>(window.addEventListener("mousemove",eK),window.addEventListener("mouseup",eH),()=>{window.removeEventListener("mousemove",eK),window.removeEventListener("mouseup",eH)}),[eK,eH]),P)?(0,t.jsx)(j.A,{}):(0,t.jsxs)("div",{ref:_,className:"relative flex h-full w-full overflow-hidden bg-background dark:bg-background",style:{cursor:V?"col-resize":"default"},children:[(0,t.jsxs)("div",{className:"flex-grow relative h-full overflow-hidden",children:[(0,t.jsxs)(i.Gc,{nodes:em,edges:ek,onNodesChange:ew,onEdgesChange:ef,onConnect:eg,nodeTypes:K,edgeTypes:L,fitView:!0,onInit:eC,onNodeClick:ey,onEdgeClick:eE,onPaneClick:ej,onNodesDelete:eS,proOptions:{hideAttribution:!0},panOnDrag:"hand"===ei&&!Q.filter(Boolean).some(e=>e.selected),panOnScroll:!0,zoomOnScroll:!0,minZoom:.1,maxZoom:2,selectionMode:"pointer"===ei?s.Qc.Full:s.Qc.Partial,selectNodesOnDrag:"pointer"===ei,selectionOnDrag:"pointer"===ei,selectionKeyCode:"pointer"===ei?null:"Shift",multiSelectionKeyCode:"pointer"===ei?null:"Shift",deleteKeyCode:"Delete",nodesConnectable:!0,connectionMode:s.WZ.Loose,onNodeMouseEnter:eO,onNodeMouseLeave:eV,onEdgeMouseEnter:ev,onEdgeMouseLeave:ex,snapToGrid:!1,onNodeDrag:eT,onNodeDragStop:eM,children:[(0,t.jsx)(i.VS,{}),!1,(0,t.jsx)(A.A,{handleLayout:eI,handleDownloadImage:eB}),(0,t.jsx)(i.Zk,{position:"top-right",children:(0,t.jsx)(a.I,{content:M?"Hide Chat":"Show Chat",children:(0,t.jsx)(d.T,{isIconOnly:!0,variant:"flat",size:"sm",onPress:()=>{B(e=>!e)},"aria-label":M?"Hide Chat":"Show Chat",children:(0,t.jsx)(r.In,{icon:M?"lucide:panel-right-close":"lucide:panel-right-open",width:20})})})})]}),Z&&(0,t.jsx)("div",{className:"absolute top-0 right-0 h-full bg-background dark:bg-background/80 border-l border-divider",style:{zIndex:10},children:(0,t.jsx)(I.A,{nodeID:Z,readOnly:!1},Z)}),(0,t.jsx)("div",{className:"border-divider absolute top-4 left-4",style:{zIndex:2},children:(0,t.jsx)(S.A,{})})]}),M&&(0,t.jsx)(O,{workflowID:o,width:D,onResizeStart:e_})]})},O=g.memo(e=>{let{workflowID:l,width:o,onResizeStart:n}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-1 bg-border hover:bg-primary cursor-col-resize h-[calc(100vh-48px)] relative z-5",onMouseDown:n}),(0,t.jsx)("div",{className:"h-[calc(100vh-48px)] bg-background dark:bg-background/80 border-l border-divider overflow-hidden flex flex-col",style:{width:"".concat(o,"px"),zIndex:5},children:(0,t.jsx)("div",{className:"w-full h-full overflow-hidden",children:(0,t.jsx)(E.A,{workflowID:l})})})]})});O.displayName="ChatPanel";let V=e=>{let{workflowData:l,workflowID:o,onDownloadImageInit:n}=e;return(0,t.jsx)(i.Ln,{children:(0,t.jsx)(z,{workflowData:l,workflowID:o,onDownloadImageInit:n})})}}}]);