"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[873],{39873:(e,t,o)=>{o.r(t),o.d(t,{default:()=>z});var l=o(74848),n=o(96540),a=o(87947),s=o(53692);o(69703);var r=o(71468),i=o(36240),d=o(29838),c=o(43346),u=o(50227),g=o(45388),h=o(73486),p=o(69554),m=o(52136),x=o(80893),f=(o(33596),o(38947)),y=o(53212),w=o(5266),v=o(48850),b=o(52153),C=o(84994),k=o(95258),j=o(7651),N=o(2404),S=o.n(N),I=o(46421),E=o(7350),A=o.n(E),O=o(37399),D=o(88781);let L={custom:x.A},_=e=>e.reduce((e,t)=>{let o=t.category||"Other";if(!e[o]){var l,n;e[o]={nodes:[],logo:t.logo,color:null===(l=t.visual_tag)||void 0===l?void 0:l.color,acronym:null===(n=t.visual_tag)||void 0===n?void 0:n.acronym}}return e[o].nodes.push(t),e},{}),V=e=>{let{workflowData:t,workflowID:o,onDownloadImageInit:x}=e,N=(0,r.wA)(),E=(0,r.d4)(e=>e.flow.projectName),V=(0,r.d4)(e=>e.nodeTypes.data),{nodeTypes:z,isLoading:M}=(0,k.Tj)({nodeTypesConfig:V,readOnly:!1,includeCoalesceNode:!0});(0,n.useEffect)(()=>{t&&N((0,d.R$)({nodeTypes:V,definition:t.definition,workflowID:o,name:t.name}))},[N,t,o,V]);let Y=(0,r.d4)(e=>e.flow.nodes,S()),T=(0,r.d4)(e=>e.flow.edges,S()),F=(0,r.d4)(e=>e.flow.nodeConfigs,S()),B=(0,r.d4)(e=>e.flow.selectedNode),K=(0,r.d4)(e=>e.flow.selectedEdgeId),Q=(0,w.y)();(0,n.useEffect)(()=>{(Y.length>0||T.length>0||Object.keys(F).length>0)&&Q()},[Y,T,F,Q]);let[R,W]=(0,n.useState)(null),[P,Z]=(0,n.useState)({horizontal:null,vertical:null}),[q,G]=(0,n.useState)(null),[H,J]=(0,n.useState)(null),[U,$]=(0,n.useState)(!1),[X,ee]=(0,n.useState)(null),[et,eo]=(0,n.useState)({x:0,y:0}),[el,en]=(0,n.useState)(new Set),[ea,es]=(0,n.useState)(new Set(["AI","Code Execution","Logic","Experimental","Integrations"])),er=(0,y.y)(e=>e.mode),{getIntersectingNodes:ei,getNodes:ed,updateNode:ec,getViewport:eu}=(0,a.VH)(),eg=(0,n.useCallback)(e=>{let{sourceNode:t,targetNode:o,edgeId:l}=e;if(!R)return;let n=(t.position.x+o.position.x)/2,a=(t.position.y+o.position.y)/2,s=R.flowToScreenPosition({x:n,y:a});eo({x:s.x,y:s.y}),ee({sourceNode:t,targetNode:o,edgeId:l}),$(!0)},[R]),{onNodesChange:eh,onEdgesChange:ep,onConnect:em,onNodeDragStop:ex}=(0,k.dW)({dispatch:N,nodes:Y,setHelperLines:Z}),ef=(0,k.Bf)({edges:T,hoveredNode:q,hoveredEdge:H,selectedEdgeId:K,handlePopoverOpen:eg}),ey=(0,k.ml)({nodes:Y,mode:er}),ew=(0,k.Fu)({nodes:ey}),ev=(0,n.useCallback)((e,t)=>{J(t.id)},[J]),eb=(0,n.useCallback)(()=>{J(null)},[J]),eC=(0,n.useCallback)(e=>{W(e),e.setViewport({x:0,y:0,zoom:.8})},[]),ek=(0,n.useCallback)((e,t)=>{N((0,d.Qi)({nodeId:t.id}))},[N]),ej=(0,n.useCallback)((e,t)=>{N((0,d.Yy)({edgeId:t.id}))},[N]),eN=(0,n.useCallback)(()=>{B&&N((0,d.Qi)({nodeId:null})),K&&N((0,d.Yy)({edgeId:null})),N((0,C.iv)(!1))},[N,B,K]),eS=(0,n.useCallback)(e=>{e.forEach(e=>{N((0,d.AC)({nodeId:e.id})),B===e.id&&N((0,d.Qi)({nodeId:null}))})},[N,B]),eI=(0,n.useCallback)(e=>{let t=e.target,o=t.tagName.toLowerCase();if(t.isContentEditable||"input"===o||"textarea"===o||"select"===o)return;let l=document.querySelector("[data-node-panel]"),n=(null==l?void 0:l.getAttribute("data-expanded"))==="true",a=null==l?void 0:l.contains(document.activeElement);if("Delete"===e.key||"Backspace"===e.key){let e=Y.filter(e=>e.selected);e.length>0&&eS(e);return}if(n&&a)return;let s=e.shiftKey?45:15;if(R){let{x:t,y:o,zoom:l}=R.getViewport();switch(e.key){case"ArrowLeft":R.setViewport({x:t+s,y:o,zoom:l});break;case"ArrowRight":R.setViewport({x:t-s,y:o,zoom:l});break;case"ArrowUp":R.setViewport({x:t,y:o+s,zoom:l});break;case"ArrowDown":R.setViewport({x:t,y:o-s,zoom:l})}}},[Y,eS,R]),eE=(0,n.useCallback)(()=>{let e=(0,j.B)(Y,T);N((0,d.CU)({nodes:e}))},[Y,T,N]);(0,n.useEffect)(()=>(window.addEventListener("keydown",eI),()=>{window.removeEventListener("keydown",eI)}),[eI]),(0,m.K)(B,Y,z,V,N,eE);let{cut:eA,copy:eO,paste:eD,bufferedNodes:eL}=(0,f.A)();(0,f.A)();let e_=(0,n.useCallback)((e,t)=>{G(t.id)},[G]),eV=(0,n.useCallback)(()=>{G(null)},[G]),ez=(0,n.useCallback)((e,t,o,l)=>{(0,k.HB)(Y,V,e,t,o,l,N,()=>$(!1))},[Y,V,R,N,$]),eM=(0,n.useCallback)(A()((e,t)=>{(0,I.tJ)(e,t,Y,N,ei,ed,ec)},16),[Y,N,ei]),eY=(0,n.useCallback)((e,t)=>{(0,I.Lm)(e,t,Y,T,N,ei,ed,ec),ex(e,t)},[Y,T,N,ei,ed,ec,ex]),eT=e=>{en(t=>{let o=new Set(t);return o.has(e)?o.delete(e):o.add(e),o})},eF=e=>{es(t=>{let o=new Set(t);return o.has(e)?o.delete(e):o.add(e),o})},eB=(0,n.useCallback)(()=>{let e=ed(),t=(0,s.Jo)(e),o=t.width||1,l=t.height||1,n=Math.min(1080/o,607.5/l),a=(0,s.R4)(t,1200,675,n,n,.05*Math.min(o,l));(0,D.$E)(document.querySelector(".react-flow__viewport"),{backgroundColor:"transparent",width:1200,height:675,style:{width:"".concat(1200,"px"),height:"".concat(675,"px"),transform:"translate(".concat(a.x,"px, ").concat(a.y,"px) scale(").concat(a.zoom,")")}}).then(e=>{let t=document.createElement("a");t.href=e,t.download="".concat(E,".png"),t.click()}).catch(e=>{console.error("Failed to download image",e)})},[ed,E]);return((0,n.useEffect)(()=>{x&&x(eB)},[eB,x]),M)?(0,l.jsx)(v.A,{}):(0,l.jsxs)("div",{style:{position:"relative",height:"100%"},children:[U&&X&&(0,l.jsx)("div",{style:{position:"absolute",left:"".concat(et.x,"px"),top:"".concat(et.y,"px"),transform:"translate(-50%, -50%)",zIndex:1e3},children:(0,l.jsxs)(u.A,{isOpen:U,onOpenChange:e=>{e||$(!1)},placement:"bottom",children:[(0,l.jsx)(g.b,{children:(0,l.jsx)("div",{})}),(0,l.jsx)(h.y,{"aria-label":"Add node options",closeOnSelect:!1,onAction:e=>{let t=e.toString();if(t.startsWith("toggle-category-")){eF(t.replace("toggle-category-",""));return}if(t.startsWith("toggle-")){eT(t.replace("toggle-",""));return}ez(t,X.sourceNode,X.targetNode,X.edgeId),$(!1)},children:V&&Object.keys(V).filter(e=>"Input/Output"!==e).map(e=>{let t=V[e],o=t.some(e=>e.category);return(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(p.Y,{className:"font-bold opacity-70 flex items-center gap-2",startContent:(0,l.jsx)(O.In,{icon:ea.has(e)?"solar:alt-arrow-down-linear":"solar:alt-arrow-right-linear",className:"text-default-500"}),children:e},"toggle-category-".concat(e)),ea.has(e)&&("Integrations"===e?Object.entries(_(t)).map(e=>{let[t,{nodes:o}]=e;return(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(p.Y,{className:"font-semibold pl-4 flex items-center gap-2",startContent:(0,l.jsx)(O.In,{icon:el.has(t)?"solar:alt-arrow-down-linear":"solar:alt-arrow-right-linear",className:"text-default-500"}),children:t},"toggle-".concat(t)),el.has(t)&&o.map(e=>{var t,o;return(0,l.jsx)(p.Y,{className:"pl-8",startContent:e.logo?(0,l.jsx)("img",{src:e.logo,alt:"".concat(e.config.title," Logo"),className:"w-5 h-5"}):(0,l.jsx)("div",{className:"node-acronym-tag text-white px-2 py-1 rounded-full text-xs",style:{backgroundColor:null===(t=e.visual_tag)||void 0===t?void 0:t.color},children:null===(o=e.visual_tag)||void 0===o?void 0:o.acronym}),children:e.config.title},e.name)})]},t)}):o?Object.entries(_(t)).map(e=>{let[t,{nodes:o}]=e;return(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(p.Y,{className:"font-semibold opacity-70 pl-4",isReadOnly:!0,children:t},"".concat(t,"-header")),o.map(e=>{var t,o;return(0,l.jsx)(p.Y,{className:"pl-8",startContent:e.logo?(0,l.jsx)("img",{src:e.logo,alt:"".concat(e.config.title," Logo"),className:"w-5 h-5"}):(0,l.jsx)("div",{className:"node-acronym-tag text-white px-2 py-1 rounded-full text-xs",style:{backgroundColor:null===(t=e.visual_tag)||void 0===t?void 0:t.color},children:null===(o=e.visual_tag)||void 0===o?void 0:o.acronym}),children:e.config.title},e.name)})]},t)}):t.map(e=>{var t,o;return(0,l.jsx)(p.Y,{className:"pl-4",startContent:e.logo?(0,l.jsx)("img",{src:e.logo,alt:"".concat(e.config.title," Logo"),className:"w-5 h-5"}):(0,l.jsx)("div",{className:"node-acronym-tag text-white px-2 py-1 rounded-full text-xs",style:{backgroundColor:null===(t=e.visual_tag)||void 0===t?void 0:t.color},children:null===(o=e.visual_tag)||void 0===o?void 0:o.acronym}),children:e.config.title},e.name)}))]},e)})})]})}),(0,l.jsxs)("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:[(0,l.jsx)("div",{style:{height:"100%",overflow:"auto",position:"relative",zIndex:1},children:(0,l.jsxs)(a.Gc,{nodes:ew,edges:ef,onNodesChange:eh,onEdgesChange:ep,onConnect:em,nodeTypes:z,edgeTypes:L,fitView:!0,onInit:eC,onNodeClick:ek,onEdgeClick:ej,onPaneClick:eN,onNodesDelete:eS,proOptions:{hideAttribution:!0},panOnDrag:"hand"===er&&!Y.filter(Boolean).some(e=>e.selected),panOnScroll:!0,zoomOnScroll:!0,minZoom:.1,maxZoom:2,selectionMode:"pointer"===er?s.Qc.Full:s.Qc.Partial,selectNodesOnDrag:"pointer"===er,selectionOnDrag:"pointer"===er,selectionKeyCode:"pointer"===er?null:"Shift",multiSelectionKeyCode:"pointer"===er?null:"Shift",deleteKeyCode:"Delete",nodesConnectable:!0,connectionMode:s.WZ.Loose,onNodeMouseEnter:e_,onNodeMouseLeave:eV,onEdgeMouseEnter:ev,onEdgeMouseLeave:eb,snapToGrid:!1,onNodeDrag:eM,onNodeDragStop:eY,children:[(0,l.jsx)(a.VS,{}),!1,(0,l.jsx)(i.A,{handleLayout:eE,handleDownloadImage:eB})]})}),B&&(0,l.jsx)("div",{className:"absolute top-0 right-0 h-full bg-white border-l border-gray-200",style:{zIndex:2},children:(0,l.jsx)(c.A,{nodeID:B,readOnly:!1},B)}),(0,l.jsx)("div",{className:"border-gray-200 absolute top-4 left-4",style:{zIndex:2},children:(0,l.jsx)(b.A,{})})]})]})},z=e=>{let{workflowData:t,workflowID:o,onDownloadImageInit:n}=e;return(0,l.jsx)(a.Ln,{children:(0,l.jsx)(V,{workflowData:t,workflowID:o,onDownloadImageInit:n})})}}}]);