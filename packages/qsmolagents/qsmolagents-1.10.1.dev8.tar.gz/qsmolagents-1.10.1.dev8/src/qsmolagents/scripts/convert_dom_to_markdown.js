"use strict";(()=>{var ae=Object.create;var U=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var $=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var le=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of oe(e))!ie.call(t,r)&&r!==s&&U(t,r,{get:()=>e[r],enumerable:!(n=se(e,r))||n.enumerable});return t};var ue=(t,e,s)=>(s=t!=null?ae(ce(t)):{},le(e||!t||!t.__esModule?U(s,"default",{value:t,enumerable:!0}):s,t));var H=$(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_._Node=void 0;_._Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32}});var W=$(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.htmlToMarkdownAST=y;var D=H();function y(t,e,s=0){let n=[],r=c=>{e?.debug&&console.log(c)};return t.childNodes.forEach(c=>{let u=e?.overrideElementProcessing?.(c,e,s);if(u)r(`Element Processing Overridden: '${c.nodeType}'`),n.push(...u);else if(c.nodeType===D._Node.TEXT_NODE){let a=O(c.textContent?.trim()??"");a&&c.textContent&&(r(`Text Node: '${a}'`),n.push({type:"text",content:c.textContent?.trim()}))}else if(c.nodeType===D._Node.ELEMENT_NODE){let a=c;if(/^h[1-6]$/i.test(a.tagName)){let o=parseInt(a.tagName.substring(1));r(`Heading ${o}`),n.push({type:"heading",level:o,content:y(a,e)})}else if(a.tagName.toLowerCase()==="p")r("Paragraph"),n.push(...y(a,e)),n.push({type:"text",content:`

`});else if(a.tagName.toLowerCase()==="a")if(r(`Link: '${a.href}' with text '${a.textContent}'`),typeof a.href=="string"&&a.href.startsWith("data:image"))n.push({type:"link",href:"-",content:y(a,e)});else{let o=a.href;typeof o=="string"?o=e?.websiteDomain&&o.startsWith(e.websiteDomain)?o.substring(e.websiteDomain.length):o:o="#",Array.from(a.childNodes).every(i=>i.nodeType===D._Node.TEXT_NODE)?n.push({type:"link",href:o,content:[{type:"text",content:a.textContent?.trim()??""}]}):n.push({type:"link",href:o,content:y(a,e)})}else if(a.tagName.toLowerCase()==="img")if(r(`Image: src='${a.src}', alt='${a.alt}'`),a.src?.startsWith("data:image"))n.push({type:"image",src:"-",alt:O(a.alt)});else{let o=e?.websiteDomain&&a.src?.startsWith(e.websiteDomain)?a.src?.substring(e.websiteDomain.length):a.src;n.push({type:"image",src:o,alt:O(a.alt)})}else if(a.tagName.toLowerCase()==="video")r(`Video: src='${a.src}', poster='${a.poster}', controls='${a.controls}'`),n.push({type:"video",src:a.src,poster:O(a.poster),controls:a.controls});else if(a.tagName.toLowerCase()==="ul"||a.tagName.toLowerCase()==="ol")r(`${a.tagName.toLowerCase()==="ul"?"Unordered":"Ordered"} List`),n.push({type:"list",ordered:a.tagName.toLowerCase()==="ol",items:Array.from(a.children).map(o=>({type:"listItem",content:y(o,e,s+1)}))});else if(a.tagName.toLowerCase()==="br")r("Line Break"),n.push({type:"text",content:`
`});else if(a.tagName.toLowerCase()==="table"){r("Table");let o=[];e?.enableTableColumnTracking&&Array.from(a.querySelectorAll("th, td")).forEach((g,m)=>{o.push(`col-${m}`)});let i=Array.from(a.querySelectorAll("tr")),b=i.map(f=>{let g=0;return{type:"tableRow",cells:Array.from(f.querySelectorAll("th, td")).map(l=>{let M=parseInt(l.getAttribute("colspan")||"1",10),T=parseInt(l.getAttribute("rowspan")||"1",10),C={type:"tableCell",content:l.nodeType===D._Node.TEXT_NODE?O(l.textContent?.trim()??""):y(l,e,s+1),colId:o[g],colspan:M>1?M:void 0,rowspan:T>1?T:void 0};return g+=M,C})}});if(b.length>0&&i[0].querySelector("th")!==null){let m={type:"tableRow",cells:Array.from(i[0].querySelectorAll("th, td")).map(()=>({type:"tableCell",content:"---",colId:void 0,colspan:void 0,rowspan:void 0}))};b.splice(1,0,m)}n.push({type:"table",rows:b,colIds:o})}else if(a.tagName.toLowerCase()==="head"&&e?.includeMetaData){let o={type:"meta",content:{standard:{},openGraph:{},twitter:{}}};a.querySelectorAll("title").forEach(f=>{o.content.standard.title=O(f.text)});let i=a.querySelectorAll("meta"),b=["viewport","referrer","Content-Security-Policy"];if(i.forEach(f=>{let g=f.getAttribute("name"),m=f.getAttribute("property"),l=f.getAttribute("content");m&&m.startsWith("og:")&&l?e.includeMetaData==="extended"&&(o.content.openGraph[m.substring(3)]=l):g&&g.startsWith("twitter:")&&l?e.includeMetaData==="extended"&&(o.content.twitter[g.substring(8)]=l):g&&!b.includes(g)&&l&&(o.content.standard[g]=l)}),e.includeMetaData==="extended"){let f=[];a.querySelectorAll('script[type="application/ld+json"]').forEach(m=>{try{let l=m.textContent;if(l){let M=JSON.parse(l);f.push(M)}}catch(l){console.error("Failed to parse JSON-LD",l)}}),o.content.jsonLd=f}n.push(o)}else{let o=O(a.textContent||"");switch(a.tagName.toLowerCase()){case"noscript":case"script":case"style":case"html":break;case"strong":case"b":o&&(r(`Bold: '${o}'`),n.push({type:"bold",content:y(a,e,s+1)}));break;case"em":case"i":o&&(r(`Italic: '${o}'`),n.push({type:"italic",content:y(a,e,s+1)}));break;case"s":case"strike":o&&(r(`Strikethrough: '${o}'`),n.push({type:"strikethrough",content:y(a,e,s+1)}));break;case"code":if(o){let b=a.parentNode&&a.parentNode.nodeName.toLowerCase()==="pre";r(`${b?"Code Block":"Inline Code"}: '${o}'`);let f=a.className?.split(" ").find(m=>m.startsWith("language-")),g=f?f.replace("language-",""):"";n.push({type:"code",content:a.textContent?.trim()??"",language:g,inline:!b})}break;case"blockquote":r("Blockquote"),n.push({type:"blockquote",content:y(a,e)});break;case"article":case"aside":case"details":case"figcaption":case"figure":case"footer":case"header":case"main":case"mark":case"nav":case"section":case"summary":case"time":r(`Semantic HTML Element: '${a.tagName}'`),n.push({type:"semanticHtml",htmlType:a.tagName.toLowerCase(),content:y(a,e)});break;default:let i=e?.processUnhandledElement?.(a,e,s);i?(r(`Processing Unhandled Element: '${a.tagName}'`),n.push(...i)):(r(`Generic HTMLElement: '${a.tagName}'`),n.push(...y(a,e,s+1)));break}}}}),n}function O(t,e=!1){if(e||!t?.trim())return t;let s=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return s=s.replace(/([\\`*_{}[\]#+!|])/g,"\\$1"),s}});var F=$(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.markdownASTToString=de;var fe=L();function de(t,e,s=0){let n="";return n+=he(t,e,s),n+=S(t,e,s),n}function he(t,e,s=0){let n="";if(e?.includeMetaData){n+=`---
`;let r=(0,fe.findInMarkdownAST)(t,c=>c.type==="meta");if(r?.type==="meta"&&(r.content.standard&&Object.keys(r.content.standard).forEach(c=>{n+=`${c}: "${r.content.standard[c]}"
`}),e.includeMetaData==="extended")){if(r.content.openGraph&&Object.keys(r.content.openGraph).length>0){n+=`openGraph:
`;for(let[c,u]of Object.entries(r.content.openGraph))n+=`  ${c}: "${u}"
`}if(r.content.twitter&&Object.keys(r.content.twitter).length>0){n+=`twitter:
`;for(let[c,u]of Object.entries(r.content.twitter))n+=`  ${c}: "${u}"
`}r.content.jsonLd&&r.content.jsonLd.length>0&&(n+=`schema:
`,r.content.jsonLd.forEach(c=>{let{"@context":u,"@type":a,...o}=c;n+=`  ${a??"(unknown type)"}:
`,Object.keys(o).forEach(i=>{n+=`    ${i}: ${JSON.stringify(o[i])}
`})}))}n+=`---

`}return n}function S(t,e,s=0){let n="";return t.forEach(r=>{let c=" ".repeat(s*2),u=e?.overrideNodeRenderer?.(r,e,s);if(u)n+=u;else switch(r.type){case"text":case"bold":case"italic":case"strikethrough":case"link":let a=r.content;Array.isArray(r.content)&&(a=S(r.content,e,s));let o=n.length>0,i=/\s/.test(a.slice(0,1)),b=/\s/.test(n.slice(-1)),f=a.length===1&&/^[.,!?;:]/.test(a);o&&!f&&!i&&!b&&(n+=" "),r.type==="text"?n+=`${c}${a}`:r.type==="bold"?n+=`**${a}**`:r.type==="italic"?n+=`*${a}*`:r.type==="strikethrough"?n+=`~~${a}~~`:r.type==="link"&&(r.content.length===1&&r.content[0].type==="text"?n+=`[${a}](${encodeURI(r.href)})`:n+=`<a href="${r.href}">${a}</a>`);break;case"heading":n.slice(-1)===`
`||(n+=`
`);let m=typeof r.content=="string"?r.content:S(r.content,e,s);n+=`${"#".repeat(r.level)} ${m}

`;break;case"image":(!r.alt?.trim()||r.src?.trim())&&(n+=`![${r.alt||""}](${r.src})`);break;case"list":r.items.forEach((T,C)=>{let d=r.ordered?`${C+1}.`:"-",w=S(T.content,e,s+1).trim();n.slice(-1)!==`
`&&(n+=`
`),w&&(n+=`${c}${d} ${w}
`)}),n+=`
`;break;case"video":n+=`
![Video](${r.src})
`,r.poster&&(n+=`![Poster](${r.poster})
`),r.controls&&(n+=`Controls: ${r.controls}
`),n+=`
`;break;case"table":let l=Math.max(...r.rows.map(T=>T.cells.reduce((C,d)=>C+(d.colspan||1),0)));r.rows.forEach(T=>{let C=0;for(T.cells.forEach(d=>{let w=typeof d.content=="string"?d.content:S(d.content,e,s+1).trim();d.colId&&(w+=` <!-- ${d.colId} -->`),d.colspan&&d.colspan>1&&(w+=` <!-- colspan: ${d.colspan} -->`),d.rowspan&&d.rowspan>1&&(w+=` <!-- rowspan: ${d.rowspan} -->`),n+=`| ${w} `,C+=d.colspan||1;for(let q=1;q<(d.colspan||1);q++)n+="| "});C<l;)n+="|  ",C++;n+=`|
`}),n+=`
`;break;case"code":r.inline?(/\s/.test(n.slice(-1))||(n+=" "),n+=`\`${r.content}\``):(n+="\n```"+(r.language??"")+`
`,n+=`${r.content}
`,n+="```\n\n");break;case"blockquote":n+=`> ${S(r.content,e).trim()}

`;break;case"meta":break;case"semanticHtml":switch(r.htmlType){case"article":n+=`

`+S(r.content,e);break;case"summary":case"time":case"aside":case"nav":case"figcaption":case"main":case"mark":case"header":case"footer":case"details":case"figure":n+=`

<-${r.htmlType}->
`+S(r.content,e)+`

</-${r.htmlType}->
`;break;case"section":n+=`---

`,n+=S(r.content,e),n+=`

`,n+=`---

`;break}break;case"custom":let M=e?.renderCustomNode?.(r,e,s);M&&(n+=M);break;default:break}}),n}});var B=$(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.findMainContent=ge;E.wrapMainContent=me;E.calculateScore=A;var pe=!1,h=t=>{pe&&console.log(t)};function ge(t){h("Entering findMainContent function");let e=t.querySelector("main")||t.querySelector('[role="main"]');return e?(h("Existing <main> element found"),e):(h("No <main> element found. Detecting main content."),t.body?ye(t.body):(h("No body element found, returning document.documentElement"),t.documentElement))}function me(t,e){if(t.tagName.toLowerCase()!=="main"){h("Wrapping main content in <main> element");let s=e.createElement("main");t.before(s),s.appendChild(t),s.id="detected-main-content",h("Main content wrapped successfully")}else h("Main content already wrapped")}function ye(t){let e=[];if(h("Collecting candidates with minimum score: 20"),G(t,e,20),h(`Total candidates found: ${e.length}`),e.length===0)return h("No suitable candidates found, returning root element"),t;e.sort((r,c)=>A(c)-A(r)),h("Candidates sorted by score");let n=e[0];for(let r=1;r<e.length;r++)e.some((c,u)=>u!==r&&c.contains(e[r]))||A(e[r])>A(n)&&(n=e[r],h(`New best independent candidate found: ${I(n)}`));return h(`Final main content candidate: ${I(n)}`),n}function I(t){return t?`${t.tagName}#${t.id||"no-id"}.${Array.from(t.classList).join(".")}`:"No element"}function G(t,e,s){let n=A(t);n>=s&&(e.push(t),h(`Candidate found: ${I(t)}, score: ${n}`)),Array.from(t.children).forEach(r=>{G(r,e,s)})}function A(t){let e=0,s=[];["article","content","main-container","main","main-content"].forEach(i=>{(t.classList.contains(i)||t.id===i)&&(e+=10,s.push(`High impact attribute found: [${i}] [${[...t.classList.values()].join(",")}], score increased by 10`))}),["article","main","section"].includes(t.tagName.toLowerCase())&&(e+=5,s.push(`High impact tag found: [${t.tagName}], score increased by 5`));let c=t.getElementsByTagName("p").length,u=Math.min(c,5);u>0&&(e+=u,s.push(`Paragraph count: ${c}, score increased by ${u}`));let a=t.textContent?.trim().length||0;if(a>200){let i=Math.min(Math.floor(a/200),5);e+=i,s.push(`Text content length: ${a}, score increased by ${i}`)}let o=be(t);return o<.3&&(e+=5,s.push(`Link density: ${o.toFixed(2)}, score increased by 5`)),(t.hasAttribute("data-main")||t.hasAttribute("data-content"))&&(e+=10,s.push("Data attribute for main content found, score increased by 10")),t.getAttribute("role")?.includes("main")&&(e+=10,s.push("Role attribute indicating main content found, score increased by 10")),s.length>0&&(h(`Scoring for ${I(t)}:`),s.forEach(i=>h("  "+i)),h(`  Final score: ${e}`)),e}function be(t){let e=Array.from(t.getElementsByTagName("a")).reduce((n,r)=>n+(r.textContent?.length||0),0),s=t.textContent?.length||1;return e/s}});var Y=$(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.refifyUrls=k;var Ne=["jpeg","jpg","png","gif","bmp","tiff","tif","svg","webp","ico","avi","mov","mp4","mkv","flv","wmv","webm","mpeg","mpg","mp3","wav","aac","ogg","flac","m4a","pdf","doc","docx","ppt","pptx","xls","xlsx","txt","css","js","xml","json","html","htm"],R=(t,e)=>(e[t]||(e[t]="ref"+Object.values(e).length),e[t]),X=(t,e)=>{if(t.startsWith("http")){let s=t.split(".").slice(-1)[0];if(s&&Ne.includes(s)){let n=t.split("/"),r=n.slice(0,-1).join("/");return`${R(r,e)}://${n.slice(-1).join("")}`}else return t.split("/").length>4?R(t,e):t}else return t};function k(t,e={}){if(Array.isArray(t))t.forEach(s=>k(s,e));else switch(t.type){case"link":t.href=X(t.href,e),k(t.content,e);break;case"image":case"video":t.src=X(t.src,e);break;case"list":t.items.forEach(s=>s.content.forEach(n=>k(n,e)));break;case"table":t.rows.forEach(s=>s.cells.forEach(n=>typeof n.content=="string"?null:k(n.content,e)));break;case"blockquote":case"semanticHtml":k(t.content,e);break}return e}});var K=$(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.isNot=N.getMainContent=void 0;N.findInAST=V;N.findAllInAST=z;var Te=t=>{if(t.includes("<-main->")){let e=/(?<=<-main->)[\s\S]*?(?=<\/-main->)/;return t.match(e)?.[0]??""}else{let e=/(<-nav->[\s\S]*?<\/-nav->)|(<-footer->[\s\S]*?<\/-footer->)|(<-header->[\s\S]*?<\/-header->)|(<-aside->[\s\S]*?<\/-aside->)/g;return t.replace(e,"")}};N.getMainContent=Te;var Ce=t=>e=>!t(e);N.isNot=Ce;var J=t=>typeof t=="string";function V(t,e){let s=n=>{for(let r of n){let c=V(r,e);if(c)return c}};if(Array.isArray(t))return s(t);if(e(t))return t;switch(t.type){case"link":return s(t.content);case"list":return s(t.items.map(n=>n.content).flat());case"table":return s(t.rows.map(n=>n.cells.map(r=>r.content).filter((0,N.isNot)(J))).flat());case"blockquote":case"semanticHtml":return s(t.content)}}function z(t,e){let s=n=>{let r=[];for(let c of n){let u=z(c,e);r=[...r,...u]}return r};if(Array.isArray(t))return s(t);if(e(t))return[t];switch(t.type){case"link":return s(t.content);case"list":return s(t.items.map(n=>n.content).flat());case"table":return s(t.rows.map(n=>n.cells.map(r=>r.content).filter((0,N.isNot)(J))).flat());case"blockquote":case"semanticHtml":return s(t.content)}return[]}});var L=$(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.wrapMainContent=p.refifyUrls=p.findMainContent=p.markdownASTToString=p.htmlToMarkdownAST=void 0;p.convertHtmlToMarkdown=Se;p.convertElementToMarkdown=ne;p.findInMarkdownAST=Me;p.findAllInMarkdownAST=we;var Q=W();Object.defineProperty(p,"htmlToMarkdownAST",{enumerable:!0,get:function(){return Q.htmlToMarkdownAST}});var Z=F();Object.defineProperty(p,"markdownASTToString",{enumerable:!0,get:function(){return Z.markdownASTToString}});var v=B();Object.defineProperty(p,"findMainContent",{enumerable:!0,get:function(){return v.findMainContent}});Object.defineProperty(p,"wrapMainContent",{enumerable:!0,get:function(){return v.wrapMainContent}});var ee=Y();Object.defineProperty(p,"refifyUrls",{enumerable:!0,get:function(){return ee.refifyUrls}});var te=K();function Se(t,e){let s=e?.overrideDOMParser??(typeof DOMParser<"u"?new DOMParser:null);if(!s)throw new Error("DOMParser is not available. Please provide an overrideDOMParser in options.");let n=s.parseFromString(t,"text/html"),r;return e?.extractMainContent?(r=(0,v.findMainContent)(n),e.includeMetaData&&n.querySelector("head")?.innerHTML&&!r.querySelector("head")&&(r=s.parseFromString(`<html>${n.head.outerHTML}${r.outerHTML}`,"text/html").documentElement)):e?.includeMetaData&&n.querySelector("head")?.innerHTML?r=n.documentElement:r=n.body||n.documentElement,ne(r,e)}function ne(t,e){let s=(0,Q.htmlToMarkdownAST)(t,e);return e?.refifyUrls&&(e.urlMap=(0,ee.refifyUrls)(s)),(0,Z.markdownASTToString)(s,e)}function Me(t,e){return(0,te.findInAST)(t,e)}function we(t,e){return(0,te.findAllInAST)(t,e)}});var re=ue(L());function $e(){let t=(0,re.convertElementToMarkdown)(document.body);return window.markdown=t,t}$e();})();
