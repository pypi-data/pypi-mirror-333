<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Wars - Simulation de Piratage</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f7ff;
            --dark-bg: #0a0b11;
            --card-bg: #1a1b26;
            --danger: #ff3333;
            --success: #33ff33;
            --warning: #ffcc00;
        }
        body {
            background-color: var(--dark-bg);
            color: #fff;
            font-family: 'Monaco', monospace;
        }
        p:not(.load-item), li {
            background-color : #00f7ff;
            padding:10px;
            border-radius:1%;
            color:#000;
        }
        .game-container {
            background-color: var(--card-bg);
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
        }
        .stat-card {
            background: rgba(26, 27, 38, 0.8);
            border: 1px solid var(--neon-blue);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            box-shadow: 0 0 15px var(--neon-blue);
            transform: translateY(-2px);
        }
        .btn-cyber {
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            transition: all 0.3s ease;
        }
        .btn-cyber:hover:not(:disabled) {
            background: var(--neon-blue);
            color: var(--dark-bg);
            box-shadow: 0 0 10px var(--neon-blue);
        }
        .btn-cyber:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-cyber2 {
            background: #000;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            transition: all 0.3s ease;
        }
        .btn-cyber2:hover:not(:disabled) {
            background: var(--neon-blue);
            color: var(--dark-bg);
            box-shadow: 0 0 10px var(--neon-blue);
        }
        .modal {
            background: rgba(26, 27, 38, 0.8);
            border: 1px solid var(--neon-blue);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cyber-select {
            background: var(--card-bg);
            border: 1px solid var(--neon-blue);
            color: white;
        }
        .cyber-table th {
            background: rgba(0, 247, 255, 0.1);
        }
        .cyber-table td {
            border-bottom: 1px solid rgba(0, 247, 255, 0.1);
        }
        .hidden {
            display: none;
        }
        .notification {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            color: #fff;
        }
        .notification.info {
            background-color: #2d98da;
        }
        .notification.success {
            background-color: var(--success);
        }
        .notification.error {
            background-color: var(--danger);
        }
        .notification.warning {
            background-color: var(--warning);
        }
        .mission-card.completed {
            opacity: 0.6;
        }
        .mission-overdue {
            background-color: rgba(255, 0, 0, 0.1);
        }
        .loan-item.danger {
            color: var(--danger);
        }
        .loan-item.warning {
            color: var(--warning);
        }
        .loan-item.success {
            color: var(--success);
        }
        .police-warning {
            color: var(--warning);
        }
        .loader {
            border: 4px solid var(--card-bg);
            border-top: 4px solid var(--neon-blue);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .reset-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            z-index: 100;
        }
        .reset-btn:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
            box-shadow: 0 0 5px var(--neon-blue);
        }
        .loan-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .loan-item {
            padding: 0.5rem;
            border: 1px solid var(--neon-blue);
            border-radius: 0.25rem;
            background: rgba(26, 27, 38, 0.8);
        }
        @media (max-width: 768px) {
            .loan-item {
                font-size: 0.875rem;
            }
        }
        @media (max-width: 480px) {
            .loan-item {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <button id="reset-btn" class="reset-btn">üîÑ</button>
    <div class="max-w-7xl mx-auto game-container p-6 rounded-lg">
        <h1 class="text-4xl text-center mb-8 text-[--neon-blue] font-bold">CYBER WARS</h1>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
            <div class="stat-card p-4 rounded-lg">
                <div class="text-sm opacity-70">Temps √âcoul√©</div>
                <div id="currentDate" class="text-lg font-bold text-[--neon-blue]"></div>
                <div id="elapsedTime" class="text-lg font-bold text-[--neon-blue] mt-2"></div>
            </div>
            <div class="stat-card p-4 rounded-lg">
                <div class="text-sm opacity-70">Argent</div>
                <div id="money" class="text-xl font-bold text-[--neon-blue]"></div>
                <div id="debt" class="text-sm text-[--danger]">Dette totale: 0$</div>
                <div id="loans-list" class="mt-2 space-y-1 hidden loan-container"></div>
            </div>
            <div class="stat-card p-4 rounded-lg">
                <div class="text-sm opacity-70">Localisation</div>
                <div id="currentLocation" class="text-xl font-bold text-[--neon-blue]"></div>
                <div id="police-presence" class="text-sm"></div>
                <div id="creditor-warning" class="text-sm"></div>
            </div>
            <div class="stat-card p-4 rounded-lg">
                <div class="text-sm opacity-70">Risque d'Arrestation</div>
                <div id="risk" class="text-xl font-bold text-[--neon-blue]"></div>
            </div>
            <div class="stat-card p-4 rounded-lg">
                <div class="text-sm opacity-70">Sant√©</div>
                <div id="health" class="text-xl font-bold text-[--neon-blue]"></div>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 space-y-6">
                <div id="missions-section" class="space-y-4 hidden">
                    <h2 class="text-xl font-bold text-[--neon-blue]">Missions</h2>
                    <div class="cyber-table overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="p-2 text-left">Cible</th>
                                    <th class="p-2 text-left">Outils requis</th>
                                    <th class="p-2 text-left">R√©compense ($)</th>
                                    <th class="p-2 text-left">√âch√©ance</th>
                                    <th class="p-2 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="missions-list"></tbody>
                        </table>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-[--neon-blue] mb-4">March√©</h2>
                    <div class="cyber-table overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="p-2 text-left">Nom</th>
                                    <th class="p-2 text-left">Prix</th>
                                    <th class="p-2 text-left">Type</th>
                                    <th class="p-2 text-left">Tendance</th>
                                    <th class="p-2 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="price-list"></tbody>
                        </table>
                    </div>
                </div>
                <div id="darkweb-section" class="space-y-4 hidden">
                    <h2 class="text-xl font-bold text-[--neon-blue]">Darkweb - Services Ill√©gaux</h2>
                    <div class="cyber-table overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="p-2 text-left">Service</th>
                                    <th class="p-2 text-left">Prix ($)</th>
                                    <th class="p-2 text-left">Description</th>
                                    <th class="p-2 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="darkweb-list"></tbody>
                        </table>
                    </div>
                    <button id="close-darkweb" class="btn-cyber px-4 py-2 rounded-lg mt-4">Fermer Darkweb</button>
                </div>
                <div id="news-section" class="space-y-4 hidden">
                    <h2 class="text-xl font-bold text-[--neon-blue]">Actualit√©s</h2>
                    <div id="news-list" class="space-y-2"></div>
                </div>
            </div>
            <div class="space-y-6">
                <div>
                    <h2 class="text-xl font-bold text-[--neon-blue] mb-4">Actions</h2>
                    <div class="space-y-2">
                        <button id="travel-btn" class="btn-cyber w-full p-2 rounded-lg">Voyager</button>
                        <button id="mission-btn" class="btn-cyber w-full p-2 rounded-lg">Nouvelle Mission</button>
                        <button id="darkweb-btn" class="btn-cyber w-full p-2 rounded-lg">Darkweb</button>
                        <button id="loan-btn" class="btn-cyber w-full p-2 rounded-lg">Emprunter</button>
                        <button id="restart-btn" class="btn-cyber w-full p-2 rounded-lg">Recommencer</button>
                    </div>
                </div>
                <div id="travel-section" class="space-y-4">
                    <h2 class="text-xl font-bold text-[--neon-blue] mb-4">Destination</h2>
                    <select id="location-select" class="cyber-select w-full p-2 rounded-lg mb-4"></select>
                    <div id="target-list" class="space-y-2">
                        <h3 class="text-sm font-bold mb-2">Cibles Disponibles</h3>
                        <ul id="targets-available" class="list-disc list-inside space-y-1"></ul>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-[--neon-blue] mb-4">Inventaire</h2>
                    <div class="cyber-table overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="p-2 text-left">Type</th>
                                    <th class="p-2 text-left">Nom</th>
                                    <th class="p-2 text-left">Quantit√©</th>
                                    <th class="p-2 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="market-modal" class="modal hidden">
                <div class="bg-[--card-bg] p-6 rounded-lg max-w-2xl w-full">
                    <h2 class="text-xl font-bold text-[--neon-blue] mb-4 text-center">March√©</h2>
                    <div id="market-items" class="space-y-2 mb-4"></div>
                    <button id="close-market" class="btn-cyber px-4 py-2 rounded-lg">Fermer</button>
                </div>
            </div>
            <div id="loan-modal" class="modal hidden">
                <div class="bg-[--card-bg] p-6 rounded-lg w-96 h-72 flex flex-col justify-center items-center">
                    <h2 class="text-xl font-bold text-[--neon-blue] mb-4 text-center">Contracter un Emprunt</h2>
                    <div class="space-y-4 w-full px-4">
                        <label class="block text-sm mb-2 text-center">Montant</label>
                        <input type="number" id="loan-amount" class="cyber-select w-full p-2" min="100" step="100">
                        <div id="loan-info" class="text-sm text-center"></div>
                        <div class="flex justify-center space-x-2">
                            <button id="cancel-loan" class="btn-cyber2 px-4 py-2 rounded-lg">Annuler</button>
                            <button id="confirm-loan" class="btn-cyber2 px-4 py-2 rounded-lg">Emprunter</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="game-over-modal" class="modal hidden">
                <div class="bg-[--card-bg] p-6 rounded-lg w-96 h-auto flex flex-col justify-center items-center">
                    <h2 class="text-3xl font-bold text-[--danger] mb-4 text-center">Game Over</h2>
                    <p class="text-center mb-4" id="game-over-reason"></p>
                    <label class="block text-sm mb-2 text-center">Entrez votre pseudo pour le Hall of Fame:</label>
                    <input type="text" id="player-name" class="cyber-select w-full p-2 mb-4" maxlength="20">
                    <button id="submit-score" class="btn-cyber2 px-4 py-2 rounded-lg">Soumettre</button>
                </div>
            </div>
            <div id="hall-of-fame-modal" class="modal hidden">
                <div class="bg-[--card-bg] p-6 rounded-lg w-96 h-auto flex flex-col justify-center items-center">
                    <h2 class="text-3xl font-bold text-[--neon-blue] mb-4 text-center">Hall of Fame</h2>
                    <div id="hall-of-fame-list" class="w-full mb-4"></div>
                    <button id="restart-game" class="btn-cyber px-4 py-2 rounded-lg">Recommencer le jeu</button>
                </div>
            </div>
            <div id="notification" class="fixed bottom-4 right-4 max-w-sm"></div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.7.0/chart.min.js"></script>
            <script>
                const CONFIG = {
                    TIME_MULTIPLIER: 1,
                    TRAVEL_COST: 100,
                    MAX_RISK: 100,
                    POLICE_PRESENCE_THRESHOLD: 30,
                    MISSION_TIME_LIMIT: 60,
                    PRICE_UPDATE_INTERVAL: 5000,
                    NEWS_UPDATE_INTERVAL: 30000,
                    BASE_INTEREST_RATE: 0.5,
                    MISSION_REWARD_MULTIPLIER: 2,
                    RISK_INCREASE_TOR: 10,
                    RISK_DECREASE_DECAY: 0.995,
                    RISK_DECREASE_INTERVAL: 60000
                };
                let gameState = {
                    money: 1000,
                    currentLocation: "Silicon Valley",
                    risk: 0,
                    health: 100,
                    debt: 0,
                    loans: [],
                    gameDate: new Date(),
                    inventory: new Map(),
                    missions: [],
                    news: [],
                    activeMission: null,
                    policePresence: new Map(),
                    availableCities: ["Silicon Valley", "Berlin", "Shanghai", "Moscow", "Paris", "S√£o Paulo"],
                    darkwebServices: [
                        { id: 101, name: "Assassin", price: 1000, description: "Service d'assassinat sur cible sp√©cifique." },
                        { id: 102, name: "Hacker Professionnel", price: 1500, description: "Service de piratage avanc√©." },
                        { id: 103, name: "Falsification de Documents", price: 500, description: "Cr√©ation de documents falsifi√©s." }
                    ],
                    cityTargets: {
                        "Silicon Valley": ["Banques", "Technologies", "PME"],
                        "Berlin": ["Infrastructures critiques", "Industries", "Cloud"],
                        "Shanghai": ["Militaire", "A√©roports", "√ânergie"],
                        "Moscow": ["Banques", "Messageries", "Justice"],
                        "S√£o Paulo": ["Logistique", "Justice", "e-Commerce"],
                        "Paris": ["Universit√©s", "Militaire", "M√©dias"]
                    },
                    gameStartDate: new Date(),
                    gameOver: false // New flag to signal game end
                };
                const GAME_DATA = {
                    items: [
                        { id: 1, name: "Phishing", basePrice: 100, type: "Attaque", volatility: 0.2 },
                        { id: 2, name: "Spear Phishing", basePrice: 150, type: "Attaque", volatility: 0.3 },
                        { id: 3, name: "Ransomware", basePrice: 300, type: "Attaque", volatility: 0.4 },
                        { id: 4, name: "Malware", basePrice: 200, type: "Attaque", volatility: 0.25 },
                        { id: 5, name: "Spyware", basePrice: 250, type: "Attaque", volatility: 0.35 },
                        { id: 6, name: "ILOVEYOU", basePrice: 100, type: "Malware", volatility: 0.2 },
                        { id: 7, name: "WannaCry", basePrice: 300, type: "Malware", volatility: 0.45 },
                        { id: 8, name: "NotPetya", basePrice: 350, type: "Malware", volatility: 0.5 },
                        { id: 9, name: "Stuxnet", basePrice: 500, type: "Malware", volatility: 0.6 },
                        { id: 10, name: "CryptoLocker", basePrice: 300, type: "Malware", volatility: 0.4 }
                    ],
                    newsEvents: [
                        { id: 1, text: "Nouvelle faille Zero-Day d√©couverte", impact: { "Malware": 1.5, "Spyware": 1.3 } },
                        { id: 2, text: "Renforcement global de la cybers√©curit√©", impact: { "Phishing": 0.7, "Ransomware": 0.8 } },
                        { id: 3, text: "Attaque massive sur des infrastructures critiques", impact: { "Stuxnet": 2.0, "NotPetya": 1.8 } },
                        { id: 4, text: "Nouvelle l√©gislation sur la cybers√©curit√©", impact: { "WannaCry": 0.5, "CryptoLocker": 0.6 } },
                        { id: 5, text: "Fuite de donn√©es massive", impact: { "Spear Phishing": 1.4, "ILOVEYOU": 1.2 } }
                    ]
                };
                let marketData = {};
                function saveGameState() {
                    const serializedState = {
                        ...gameState,
                        gameDate: gameState.gameDate.toISOString(),
                        gameStartDate: gameState.gameStartDate.toISOString(),
                        inventory: Array.from(gameState.inventory.entries()), // [ [id, {name, type, quantity}], ... ]
                        policePresence: Array.from(gameState.policePresence.entries()),
                        loans: gameState.loans.map(loan => ({
                            ...loan,
                            deadline: loan.deadline.toISOString()
                        })),
                        missions: gameState.missions.map(mission => ({
                            ...mission,
                            deadline: mission.deadline.toISOString()
                        })),
                        marketData: marketData
                    };
                    localStorage.setItem('gameState', JSON.stringify(serializedState));
                    console.log("√âtat du jeu sauvegard√©.");
                }
                function loadGameState() {
                    const savedState = localStorage.getItem('gameState');
                    if (savedState) {
                        const parsedState = JSON.parse(savedState);
                        gameState = {
                            ...parsedState,
                            gameDate: new Date(parsedState.gameDate),
                            gameStartDate: new Date(parsedState.gameStartDate),
                            inventory: new Map(parsedState.inventory),
                            policePresence: new Map(parsedState.policePresence),
                            loans: parsedState.loans.map(loan => ({
                                ...loan,
                                deadline: new Date(loan.deadline)
                            })),
                            missions: parsedState.missions.map(mission => ({
                                ...mission,
                                deadline: new Date(mission.deadline)
                            }))
                        };
                        marketData = parsedState.marketData || initializeMarketData();
                        console.log("√âtat du jeu charg√©.");
                    } else {
                        gameState.gameStartDate = new Date();
                        gameState.gameDate = new Date(gameState.gameStartDate.getTime());
                        marketData = initializeMarketData();
                        console.log("Aucun √©tat de jeu sauvegard√© trouv√©. Initialisation par d√©faut.");
                    }
                }
                function initializeMarketData() {
                    const cities = ["Silicon Valley", "Berlin", "Shanghai", "Moscow", "S√£o Paulo", "Paris"];
                    const initializedMarketData = {};
                    cities.forEach(city => {
                        initializedMarketData[city] = {};
                        GAME_DATA.items.forEach(item => {
                            initializedMarketData[city][item.id] = {
                                price: item.basePrice,
                                type: item.type,
                                trend: Math.random() > 0.5 ? "‚ÜóÔ∏è" : "‚ÜòÔ∏è",
                                available: false
                            };
                        });
                    });
                    GAME_DATA.items.forEach(item => {
                        let availableInAtLeastOne = false;
                        cities.forEach(city => {
                            if (Math.random() > 0.2) {
                                initializedMarketData[city][item.id].available = true;
                                availableInAtLeastOne = true;
                            } else {
                                initializedMarketData[city][item.id].available = false;
                            }
                        });
                        if (!availableInAtLeastOne) {
                            const randomCity = cities[Math.floor(Math.random() * cities.length)];
                            initializedMarketData[randomCity][item.id].available = true;
                        }
                    });
                    return initializedMarketData;
                }
                function resetGameState() {
                    localStorage.removeItem('gameState');
                    localStorage.removeItem('hallOfFame');
                    const startDate = new Date();
                    gameState = {
                        money: 1000,
                        currentLocation: "Silicon Valley",
                        risk: 0,
                        health: 100,
                        debt: 0,
                        loans: [],
                        gameDate: new Date(startDate),
                        inventory: new Map(),
                        missions: [],
                        news: [],
                        activeMission: null,
                        policePresence: new Map(),
                        availableCities: ["Silicon Valley", "Berlin", "Shanghai", "Moscow", "Paris", "S√£o Paulo"],
                        darkwebServices: [
                            { id: 101, name: "Assassin", price: 1000, description: "Service d'assassinat sur cible sp√©cifique." },
                            { id: 102, name: "Hacker Professionnel", price: 1500, description: "Service de piratage avanc√©." },
                            { id: 103, name: "Falsification de Documents", price: 500, description: "Cr√©ation de documents falsifi√©s." }
                        ],
                        cityTargets: {
                            "Silicon Valley": ["Banques", "Technologies", "PME"],
                            "Berlin": ["Infrastructures critiques", "Industries", "Cloud"],
                            "Shanghai": ["Militaire", "A√©roports", "√ânergie"],
                            "Moscow": ["Banques", "Messageries", "Justice"],
                            "S√£o Paulo": ["Logistique", "Justice", "e-Commerce"],
                            "Paris": ["Universit√©s", "Militaire", "M√©dias"]
                        },
                        gameStartDate: startDate,
                        gameOver: false // New flag to signal game end
                    };
                    marketData = initializeMarketData();
                    location.reload();
                }
                function initGame() {
                    loadGameState();
                    if (gameState.inventory.size === 0) {
                        // Initialisation des items avec quantity: 0
                        GAME_DATA.items.forEach(item => {
                            gameState.inventory.set(item.id, {
                                name: item.name,
                                type: item.type,
                                quantity: 0
                            });
                        });
                        // Ajout initial des items sp√©cifiques avec quantity: 1
                        const initialItems = [1, 5]; // IDs des items que vous voulez initialement poss√©der (Phishing et Spyware)
                        initialItems.forEach(itemId => {
                            const item = GAME_DATA.items.find(i => i.id === itemId);
                            if (item) {
                                gameState.inventory.set(item.id, {
                                    name: item.name,
                                    type: item.type,
                                    quantity: 1
                                });
                                console.log(`Initialisation: Ajout de ${item.name} avec quantit√© 1.`);
                            }
                        });
                    }
                    if (gameState.policePresence.size === 0) {
                        gameState.availableCities.forEach(city => {
                            gameState.policePresence.set(city, Math.random() * 30);
                        });
                    }
                    populateLocationSelect();
                    updateUI();
                    startGameLoops();
                    initEventListeners();
                }
                function populateLocationSelect() {
                    const locationSelect = document.getElementById("location-select");
                    locationSelect.innerHTML = "";
                    gameState.availableCities.forEach(city => {
                        const option = document.createElement("option");
                        option.value = city;
                        option.textContent = city;
                        if (city === gameState.currentLocation) {
                            option.selected = true;
                        }
                        locationSelect.appendChild(option);
                    });
                    updateTargetsList();
                }
                function initEventListeners() {
                    document.getElementById("travel-btn").addEventListener("click", travel);
                    document.getElementById("mission-btn").addEventListener("click", initMission);
                    document.getElementById("darkweb-btn").addEventListener("click", connectToTorNetwork);
                    document.getElementById("loan-btn").addEventListener("click", showLoanModal);
                    document.getElementById("close-market").addEventListener("click", closeMarketModal);
                    document.getElementById("confirm-loan").addEventListener("click", () => {
                        const amount = parseInt(document.getElementById("loan-amount").value);
                        if (amount >= 100) requestLoan(amount);
                        else showNotification("Le montant minimum d'emprunt est de 100$", "error");
                    });
                    document.getElementById("cancel-loan").addEventListener("click", closeLoanModal);
                    document.getElementById("loan-amount").addEventListener("input", updateLoanInfo);
                    document.getElementById("close-darkweb").addEventListener("click", closeDarkwebModal);
                    document.getElementById("reset-btn").addEventListener("click", resetGame);
                    document.getElementById("restart-btn").addEventListener("click", resetGame);
                    document.getElementById('submit-score').addEventListener('click', submitScore);
                    document.getElementById('restart-game').addEventListener('click', () => {
                        resetGameState();
                        location.reload();
                    });
                }
                function startGameLoops() {
                    setInterval(updateGameTime, 1000);
                    setInterval(updateMarketPrices, CONFIG.PRICE_UPDATE_INTERVAL);
                    setInterval(updateNews, CONFIG.NEWS_UPDATE_INTERVAL);
                    setInterval(checkMissions, 1000);
                    setInterval(checkLoans, 1000);
                    setInterval(updatePolicePresence, CONFIG.PRICE_UPDATE_INTERVAL);
                    setInterval(decreaseRisk, CONFIG.RISK_DECREASE_INTERVAL);
                    setInterval(saveGameState, 1000);
                    setInterval(checkForCreditorAggressions, 5000);
                }

                function updateGameTime() {
                    if (gameState.gameOver) return; // Stop if game is over
                    const elapsedTime = Math.floor((Date.now() - gameState.gameStartDate) / 1000);
                    document.getElementById('elapsedTime').textContent = `${elapsedTime} sec`;
                    document.getElementById('currentDate').textContent = formatDate(new Date());
                }
                function formatDate(date) {
                    const options = {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    };
                    return date.toLocaleDateString('fr-FR', options);
                }
                function formatElapsedTime() {
                    const elapsedSec = Math.floor((Date.now() - gameState.gameStartDate) / 1000);
                    const seconds = elapsedSec % 60;
                    const minutes = Math.floor((elapsedSec / 60) % 60);
                    const hours = Math.floor((elapsedSec / 3600) % 24);
                    const days = Math.floor(elapsedSec / 86400);
                    if (days > 0) return `${days} jour${days > 1 ? 's' : ''}, ${hours} h`;
                    else if (hours > 0) return `${hours} h ${minutes} min`;
                    else if (minutes > 0) return `${minutes} min ${seconds} sec`;
                    else return `${seconds} sec`;
                }
                function calculatePrice(item) {
                    const basePrice = item.basePrice;
                    const cityData = marketData[gameState.currentLocation][item.id];
                    let price = basePrice;
                    if (cityData.trend === "‚ÜóÔ∏è") {
                        price *= 1.1;
                    } else {
                        price *= 0.9;
                    }
                    const volatilityFactor = 1 + (Math.random() - 0.5) * item.volatility;
                    price *= volatilityFactor;
                    gameState.news.forEach(news => {
                        if (news.impact[item.name]) {
                            price *= news.impact[item.name];
                        }
                    });
                    return Math.round(price);
                }
                function updatePriceList() {
                    const priceTable = document.getElementById("price-list");
                    priceTable.innerHTML = "";
                    GAME_DATA.items.forEach(item => {
                        const cityData = marketData[gameState.currentLocation][item.id];
                        if (cityData.available) {
                            const price = calculatePrice(item);
                            const trend = cityData.trend;
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td class="p-2">${item.name}</td>
                                <td class="p-2">${price} $</td>
                                <td class="p-2">${item.type}</td>
                                <td class="p-2">${trend}</td>
                                <td class="p-2">
                                    <button onclick="buyItem(${item.id})" class="btn-cyber px-2 py-1">Acheter</button>
                                </td>
                            `;
                            priceTable.appendChild(row);
                        } else {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td class="p-2">${item.name}</td>
                                <td class="p-2">${calculatePrice(item)} $</td>
                                <td class="p-2">${item.type}</td>
                                <td class="p-2">${marketData[gameState.currentLocation][item.id].trend}</td>
                                <td class="p-2"></td>
                            `;
                            priceTable.appendChild(row);
                        }
                    });
                    toggleSectionVisibility(priceTable, "March√©");
                }
                
function buyItem(itemId) {
    // Convertir itemId en nombre
    const parsedItemId = Number(itemId);
    if (isNaN(parsedItemId)) {
        showNotification("ID d'item invalide.", "error");
        console.error(`ID d'item invalide: ${itemId}`);
        return;
    }

    const item = GAME_DATA.items.find(i => i.id === parsedItemId);
    if (!item) {
        showNotification("Item non trouv√©.", "error");
        console.error(`Item avec ID ${parsedItemId} non trouv√© dans GAME_DATA.items.`);
        return;
    }
    const price = calculatePrice(item);

    if (!marketData[gameState.currentLocation][item.id].available) {
        showNotification("Cet objet n'est pas disponible dans cette ville.", "error");
        console.warn(`Item ${item.name} non disponible dans la ville ${gameState.currentLocation}.`);
        return;
    }

    if (gameState.money < price) {
        showNotification("Fonds insuffisants pour acheter cet item.", "error");
        console.warn(`Fonds insuffisants: ${gameState.money} < ${price}`);
        return;
    }

    gameState.money -= price;

    // Ajout de l‚Äôitem au format { name, type, quantity }
    const inventoryItem = gameState.inventory.get(parsedItemId);
    if (inventoryItem) {
        inventoryItem.quantity += 1;
        gameState.inventory.set(parsedItemId, inventoryItem);
        console.log(`Augmentation de la quantit√© de ${item.name} √† ${inventoryItem.quantity}.`);
    } else {
        gameState.inventory.set(parsedItemId, {
            name: item.name,
            type: item.type,
            quantity: 1
        });
        console.log(`Ajout de ${item.name} √† l'inventaire avec quantit√© 1.`);
    }

    showNotification(`${item.name} achet√© pour ${price}$`, "success");
    updateUI();

    // Log de l'inventaire apr√®s achat
    console.log("Inventaire apr√®s achat:", Array.from(gameState.inventory.entries()));
}

                function buyDarkwebService(serviceId) {
                    const service = gameState.darkwebServices.find(s => s.id === serviceId);
                    if (!service) {
                        showNotification("Service non trouv√©.", "error");
                        console.error(`Service avec ID ${serviceId} non trouv√© dans darkwebServices.`);
                        return;
                    }
                    const price = service.price;
                
                    if (gameState.money < price) {
                        showNotification("Fonds insuffisants pour acheter ce service.", "error");
                        console.warn(`Fonds insuffisants: ${gameState.money} < ${price}`);
                        return;
                    }
                
                    gameState.money -= price;
                
                    // Ajout du service au format { name, type: "Service", quantity }
                    const inventoryService = gameState.inventory.get(serviceId);
                    if (inventoryService) {
                        inventoryService.quantity += 1;
                        gameState.inventory.set(serviceId, inventoryService);
                        console.log(`Augmentation de la quantit√© de ${service.name} √† ${inventoryService.quantity}.`);
                    } else {
                        gameState.inventory.set(serviceId, {
                            name: service.name,
                            type: "Service",
                            quantity: 1
                        });
                        console.log(`Ajout de ${service.name} √† l'inventaire avec quantit√© 1.`);
                    }
                
                    showNotification(`${service.name} achet√© pour ${price}$`, "success");
                    updateUI(); // Mise √† jour de l'interface utilisateur pour refl√©ter l'inventaire
                }


function sellItem(itemId) {
    // Convertir itemId en nombre
    const parsedItemId = Number(itemId);
    if (isNaN(parsedItemId)) {
        showNotification("ID d'item invalide.", "error");
        console.error(`ID d'item invalide: ${itemId}`);
        return;
    }

    const inventoryItem = gameState.inventory.get(parsedItemId);

    if (!inventoryItem || inventoryItem.quantity <= 0) {
        showNotification("Vous n'avez pas cet objet ou service √† vendre.", "error");
        console.warn(`Tentative de vente d'un item/service inexistant ou sans quantit√©: ID ${parsedItemId}.`);
        return;
    }

    let sellPrice;
    if (inventoryItem.type === "Service") {
        // Vente d'un service avec une r√©duction de prix
        const service = gameState.darkwebServices.find(s => s.name === inventoryItem.name);
        if (service) {
            sellPrice = Math.round(service.price * 0.6);
            console.log(`Calcul du prix de vente pour le service ${service.name}: ${sellPrice}$`);
        } else {
            showNotification("Service non trouv√©.", "error");
            console.error(`Service avec le nom ${inventoryItem.name} non trouv√©.`);
            return;
        }
    } else {
        // Vente d'un objet de march√© selon sa disponibilit√©
        const item = GAME_DATA.items.find(i => i.id === parsedItemId);
        if (!item) {
            showNotification("Item non trouv√©.", "error");
            console.error(`Item avec ID ${parsedItemId} non trouv√© dans GAME_DATA.items.`);
            return;
        }
        const cityData = marketData[gameState.currentLocation][parsedItemId];
        const marketPrice = calculatePrice(item);
        sellPrice = cityData && cityData.available ? Math.round(marketPrice * 0.8) : Math.round(marketPrice * 1.2);
        console.log(`Calcul du prix de vente pour l'item ${item.name}: ${sellPrice}$`);
    }

    gameState.money += sellPrice;
    inventoryItem.quantity -= 1;

    if (inventoryItem.quantity === 0) {
        gameState.inventory.delete(parsedItemId);
        console.log(`Suppression de ${inventoryItem.name} de l'inventaire (quantit√© 0).`);
    } else {
        gameState.inventory.set(parsedItemId, inventoryItem);
        console.log(`D√©cr√©ment de la quantit√© de ${inventoryItem.name} √† ${inventoryItem.quantity}.`);
    }

    showNotification(`${inventoryItem.name} vendu pour ${sellPrice}$`, "success");
    updateUI();
}
                function updateInventoryList() {
                    const inventoryTable = document.getElementById("inventory-list");
                    inventoryTable.innerHTML = "";
                
                    // Afficher tous les √©l√©ments dans le tableau d'inventaire
                    gameState.inventory.forEach((inventoryItem, itemId) => {
                        if (inventoryItem.quantity > 0) {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td class="p-2">${inventoryItem.type}</td>
                                <td class="p-2">${inventoryItem.name}</td>
                                <td class="p-2">${inventoryItem.quantity}</td>
                                <td class="p-2">
                                    <button onclick="sellItem(${itemId})" class="btn-cyber px-2 py-1">Vendre</button>
                                </td>
                            `;
                            inventoryTable.appendChild(row);
                            console.log(`Affichage dans l'inventaire: ${inventoryItem.name}, Quantit√©: ${inventoryItem.quantity}`);
                        }
                    });
                
                    toggleSectionVisibility(inventoryTable, "Inventaire");
                }


                function initMission() {
                    const mission = generateMissionWithRequirements();
                    if (mission) {
                        gameState.missions.push(mission);
                        showNotification("Nouvelle mission ajout√©e.", "info");
                        updateUI();
                    } else {
                        showNotification("Impossible de g√©n√©rer une mission.", "error");
                    }
                }
                function generateMissionWithRequirements() {
                    const playerCity = gameState.currentLocation;
                    let targetCity, specificTarget;
                    do {
                        targetCity = gameState.availableCities[Math.floor(Math.random() * gameState.availableCities.length)];
                    } while (targetCity === playerCity);
                    const possibleTargets = gameState.cityTargets[targetCity];
                    if (!possibleTargets || possibleTargets.length === 0) {
                        console.error("Aucune cible sp√©cifique disponible dans la ville s√©lectionn√©e.");
                        return null;
                    }
                    specificTarget = possibleTargets[Math.floor(Math.random() * possibleTargets.length)];
                    let requiredItems = selectRequiredItems(playerCity, targetCity);
                    if (requiredItems.length === 0) {
                        const fallbackItem = GAME_DATA.items.find(item => {
                            return gameState.availableCities.some(city => 
                                city !== playerCity && 
                                city !== targetCity && 
                                marketData[city][item.id].available
                            );
                        });
                        if (fallbackItem) requiredItems.push(fallbackItem);
                    }
                    if (requiredItems.length > 0) {
                        const reward = calculateMissionReward(requiredItems);
                        const deadline = new Date(Date.now() + CONFIG.MISSION_TIME_LIMIT * 1000);
                        return {
                            id: Date.now(),
                            targetCity: targetCity,
                            specificTarget: specificTarget,
                            requiredItems: requiredItems,
                            reward: reward,
                            deadline: deadline,
                            status: 'active'
                        };
                    } else {
                        console.error("√âchec de la g√©n√©ration de mission : aucun item requis n'a √©t√© trouv√©.");
                        return null;
                    }
                }
                function selectRequiredItems(playerCity, targetCity) {
                    const availableItems = GAME_DATA.items.filter(item => {
                        return gameState.availableCities.some(city => 
                            city !== playerCity &&
                            city !== targetCity &&
                            marketData[city][item.id].available
                        );
                    });
                    const selectedItems = [];
                    const numberOfItems = Math.min(2, availableItems.length);
                    while (selectedItems.length < numberOfItems) {
                        const randomItem = availableItems[Math.floor(Math.random() * availableItems.length)];
                        if (!selectedItems.includes(randomItem)) {
                            selectedItems.push(randomItem);
                        }
                    }
                    return selectedItems;
                }
                function calculateMissionReward(tools) {
                    let baseReward = 500;
                    tools.forEach(tool => {
                        baseReward += tool.basePrice * CONFIG.MISSION_REWARD_MULTIPLIER;
                    });
                    return baseReward;
                }
                function updateMissionsList() {
                    const missionsList = document.getElementById("missions-list");
                    missionsList.innerHTML = "";
                    gameState.missions.forEach(mission => {
                        if (!mission || !mission.targetCity || !mission.specificTarget) {
                            console.error("Erreur dans les donn√©es de mission : ville ou cible sp√©cifique manquante.");
                            return;
                        }
                        const isOverdue = Date.now() > mission.deadline.getTime();
                        const row = document.createElement("tr");
                        row.className = mission.status === "completed" ? "mission-card completed" : "mission-card";
                        if (isOverdue) {
                            row.classList.add('mission-overdue');
                        }
                        const canCompleteMission = checkMissionCompletionConditions(mission);
                        row.innerHTML = `
                            <td class="p-2">${mission.specificTarget} (${mission.targetCity})</td>
                            <td class="p-2">${mission.requiredItems.map(item => item.name).join(", ")}</td>
                            <td class="p-2">${mission.reward}</td>
                            <td class="p-2">${formatDate(mission.deadline)} ${isOverdue ? '<span class="text-[--danger]">(En retard)</span>' : ''}</td>
                            <td class="p-2">
                                <button onclick="completeMission(${mission.id})" 
                                        class="btn-cyber btn-sm px-2 py-1" 
                                        ${mission.status !== "active" ? "disabled" : ""}>
                                    Compl√©ter
                                </button>
                            </td>
                        `;
                        missionsList.appendChild(row);
                        console.log(`Affichage de la mission: ${mission.specificTarget}, R√©compense: ${mission.reward}$`);
                    });
                    const missionsSection = document.getElementById("missions-section");
                    missionsSection.classList.toggle("hidden", gameState.missions.length === 0);
                }
                function checkMissionCompletionConditions(mission) {
                    if (!mission || !Array.isArray(mission.requiredItems)) {
                        return false;
                    }
                    const inTargetCity = gameState.currentLocation === mission.targetCity;
                    const hasAllItems = mission.requiredItems.every(item => {
                        const inventoryItem = gameState.inventory.get(item.id);
                        console.log(`V√©rification de l'item requis: ${item.name}, Quantit√© poss√©d√©e:`, inventoryItem ? inventoryItem.quantity : 0);
                        return inventoryItem && inventoryItem.quantity > 0;
                    });
                    console.log(`Conditions de mission: Dans la ville cible: ${inTargetCity}, Poss√®de tous les items: ${hasAllItems}`);
                    return inTargetCity && hasAllItems;
                }
                function completeMission(missionId) {
                    const mission = gameState.missions.find(m => m.id === missionId);
                    if (!mission || mission.status !== "active") return;
                    if (checkMissionCompletionConditions(mission)) {
                        mission.status = "completed";
                        gameState.money += mission.reward;
                        gameState.risk = Math.min(CONFIG.MAX_RISK, gameState.risk + 10);
                        // D√©duire les items requis de l'inventaire
                        mission.requiredItems.forEach(item => {
                            const inventoryItem = gameState.inventory.get(item.id);
                            if (inventoryItem) {
                                inventoryItem.quantity -= 1;
                                console.log(`D√©duction de 1 ${inventoryItem.name} de l'inventaire.`);
                                if (inventoryItem.quantity <= 0) {
                                    gameState.inventory.delete(item.id);
                                    console.log(`Suppression de ${inventoryItem.name} de l'inventaire (quantit√© 0).`);
                                } else {
                                    gameState.inventory.set(item.id, inventoryItem);
                                    console.log(`Mise √† jour de la quantit√© de ${inventoryItem.name} √† ${inventoryItem.quantity}.`);
                                }
                            }
                        });
                        // Supprimer la mission de la liste
                        gameState.missions = gameState.missions.filter(m => m.id !== missionId);
                        showNotification(`Mission r√©ussie ! Vous avez attaqu√© ${mission.specificTarget} et gagn√© ${mission.reward}$`, "success");
                    } else {
                        showNotification("Conditions non remplies pour cette mission.", "error");
                    }
                    updateUI();
                }
                function failMission(mission) {
                    mission.status = "failed";
                    gameState.risk = Math.min(CONFIG.MAX_RISK, gameState.risk + 20);
                    showNotification("Mission √©chou√©e - Risque augment√©", "error");
                    updateUI();
                }
                function updateMissionsStatus() {
                    // Les missions ne sont plus √©chou√©es automatiquement
                }
                function updateUI() {
                    document.getElementById('money').textContent = `${gameState.money.toFixed(2)} $`;
                    document.getElementById('currentLocation').textContent = gameState.currentLocation;
                    document.getElementById('risk').textContent = `${gameState.risk.toFixed(2)}%`;
                    document.getElementById('health').textContent = `${gameState.health}%`;
                    updateInventoryList();
                    updatePriceList();
                    updateMissionsList();
                    updateLoansList();
                    updateNewsDisplay();
                    updatePoliceDisplay();
                    updateDarkwebList();
                }
                function showNotification(message, type = "info") {
                    if (gameState.gameOver) return; // Stop notifications if game is over
                    const notification = document.createElement("div");
                    notification.className = `notification ${type}`;
                    notification.textContent = message;
                    const notificationArea = document.getElementById("notification");
                    notificationArea.appendChild(notification);
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                }
                function showMarketModal() {
                    if (document.querySelector('.modal:not(.hidden)')) return;
                    document.getElementById("market-modal").classList.remove("hidden");
                    updateMarketDisplay();
                    scrollToModal("market-modal");
                }
                function closeMarketModal() {
                    document.getElementById("market-modal").classList.add("hidden");
                }
                function showLoanModal() {
                    if (document.querySelector('.modal:not(.hidden)')) return;
                    document.getElementById("loan-modal").classList.remove("hidden");
                    scrollToModal("loan-modal");
                }
                function closeLoanModal() {
                    document.getElementById("loan-modal").classList.add("hidden");
                    document.getElementById("loan-amount").value = "";
                    document.getElementById("loan-info").textContent = "";
                }
                function connectToTorNetwork() {
                    console.log("Connexion au r√©seau Tor en cours...");
                    gameState.risk = Math.min(CONFIG.MAX_RISK, gameState.risk + CONFIG.RISK_INCREASE_TOR);
                    updateUI();
                    showNotification("Connexion au r√©seau Tor en cours...", "info");
                    setTimeout(() => {
                        console.log("Connexion au r√©seau Tor r√©ussie.");
                        showNotification("Connexion au r√©seau Tor r√©ussie.", "success");
                        showDarkwebSection();
                        updateUI();
                    }, 3000);
                }
                function showDarkwebSection() {
                    const darkwebSection = document.getElementById("darkweb-section");
                    darkwebSection.classList.remove("hidden");
                    updateDarkwebList();
                }
                function closeDarkwebModal() {
                    document.getElementById("darkweb-section").classList.add("hidden");
                }
                function requestLoan(amount) {
                    const interest = CONFIG.BASE_INTEREST_RATE;
                    const totalDebt = amount * (1 + interest);
                    const deadline = new Date(Date.now() + 60 * 1000); // D√©lai de 60 secondes
                    const city = gameState.currentLocation;
                    gameState.loans.push({ amount, total: totalDebt, deadline, status: "active", city });
                    gameState.money += amount;
                    gameState.debt += totalDebt;
                    showNotification(`Emprunt de ${amount}$ accord√©. Total √† rembourser: ${totalDebt}$`, "success");
                    updateUI();
                    closeLoanModal();
                }
                function updateLoanInfo() {
                    const amount = parseInt(document.getElementById("loan-amount").value);
                    if (isNaN(amount) || amount < 100) {
                        document.getElementById("loan-info").textContent = "";
                        return;
                    }
                    const interest = CONFIG.BASE_INTEREST_RATE;
                    const total = (amount * (1 + interest)).toFixed(2);
                    document.getElementById("loan-info").textContent = `Total √† rembourser: ${total}$`;
                }
                function updateLoansList() {
                    const debtElement = document.getElementById("debt");
                    const loansList = document.getElementById("loans-list");
                    const totalDebt = gameState.loans.reduce((acc, loan) => acc + (loan.status !== "defaulted" ? loan.total : 0), 0);
                    gameState.debt = totalDebt;
                    debtElement.innerHTML = `Dette totale: ${gameState.debt.toFixed(2)} $`;
                    loansList.innerHTML = "";
                    gameState.loans.forEach((loan, index) => {
                        const loanItem = document.createElement("div");
                        loanItem.className = `loan-item ${loan.status === "defaulted" ? "danger" : (Date.now() > loan.deadline ? "warning" : "success")}`;
                        loanItem.innerHTML = `
                            <p>Montant Emprunt√©: ${loan.amount}$</p>
                            <p>Total √† Rembourser: ${loan.total.toFixed(2)}$</p>
                            <p>√âch√©ance: ${formatDate(loan.deadline)}</p>
                            <p>Status: ${loan.status === "defaulted" ? "D√©faut" : (Date.now() > loan.deadline ? "√Ä Rembourser" : "Actif")}</p>
                        `;
                        loansList.appendChild(loanItem);
                        console.log(`Affichage du pr√™t: Montant: ${loan.amount}$, Total: ${loan.total}$, √âch√©ance: ${loan.deadline}, Status: ${loan.status}`);
                    });
                    loansList.classList.toggle("hidden", gameState.loans.length === 0);
                }
                function checkLoans() {
                    gameState.loans.forEach(loan => {
                        if (loan.status === "active" && Date.now() > loan.deadline) {
                            loan.status = "defaulted";
                            gameState.risk = Math.min(CONFIG.MAX_RISK, gameState.risk + 20);
                            showNotification("Emprunt en d√©faut ! Risque augment√©.", "error");
                            console.warn(`Emprunt en d√©faut: Montant: ${loan.amount}$`);
                        }
                    });
                    updateLoansList();
                }
                function updateNews() {
                    if (Math.random() < 0.3) {
                        const newNews = GAME_DATA.newsEvents[Math.floor(Math.random() * GAME_DATA.newsEvents.length)];
                        gameState.news.unshift(newNews);
                        if (gameState.news.length > 5) {
                            gameState.news.pop();
                        }
                        showNotification(newNews.text, "info");
                        console.log(`Nouvelle actualit√©: ${newNews.text}`);
                        updateUI();
                    }
                }
                function updateNewsDisplay() {
                    const newsList = document.getElementById("news-list");
                    newsList.innerHTML = "";
                    gameState.news.forEach(newsItem => {
                        const newsElement = document.createElement("div");
                        newsElement.className = "news-item";
                        newsElement.innerHTML = `<p>BREAKING NEWS! ${newsItem.text}</p>`;
                        newsList.appendChild(newsElement);
                        console.log(`Affichage de l'actualit√©: ${newsItem.text}`);
                    });
                    const newsSection = document.getElementById("news-section");
                    newsSection.classList.toggle("hidden", gameState.news.length === 0);
                }
                function updatePolicePresence() {
                    gameState.availableCities.forEach(city => {
                        let presence = gameState.policePresence.get(city) || 0;
                        presence += (Math.random() - 0.5) * 10;
                        presence = Math.max(0, Math.min(100, presence));
                        gameState.policePresence.set(city, presence);
                        console.log(`Pr√©sence polici√®re √† ${city}: ${presence}`);
                    });
                    updatePoliceDisplay();
                }
                function updatePoliceDisplay() {
                    const policeElement = document.getElementById('police-presence');
                    const presence = gameState.policePresence.get(gameState.currentLocation) || 0;
                    if (presence > 70) {
                        policeElement.innerHTML = '‚ö†Ô∏è Pr√©sence polici√®re tr√®s √©lev√©e !';
                        policeElement.classList.add('police-warning', 'text-[--danger]');
                        policeElement.classList.remove('text-[--warning]', 'text-[--success]');
                    } else if (presence > 40) {
                        policeElement.innerHTML = '‚ö° Pr√©sence polici√®re mod√©r√©e';
                        policeElement.classList.add('text-[--warning]');
                        policeElement.classList.remove('police-warning', 'text-[--danger]', 'text-[--success]');
                    } else {
                        policeElement.innerHTML = '‚úì Pr√©sence polici√®re faible';
                        policeElement.classList.add('text-[--success]');
                        policeElement.classList.remove('police-warning', 'text-[--danger]', 'text-[--warning]');
                    }
                    const overdueMissionsInCity = gameState.missions.filter(mission =>
                        mission.targetCity === gameState.currentLocation &&
                        mission.status === 'active' &&
                        Date.now() > mission.deadline.getTime()
                    );
                    const creditorWarningElement = document.getElementById('creditor-warning');
                    if (overdueMissionsInCity.length > 0) {
                        creditorWarningElement.innerHTML = '‚ö†Ô∏è Risque √©lev√© d\'attaque par vos cr√©anciers!';
                        creditorWarningElement.classList.add('text-[--danger]');
                        creditorWarningElement.classList.remove('text-[--warning]', 'text-[--success]');
                        console.warn(`Alerte cr√©anciers dans ${gameState.currentLocation}`);
                    } else {
                        creditorWarningElement.innerHTML = '';
                    }
                }
                function travel() {
                    const locationSelect = document.getElementById("location-select");
                    const destination = locationSelect.value;
                    if (destination && destination !== gameState.currentLocation) {
                        const travelCost = CONFIG.TRAVEL_COST;
                        if (gameState.money >= travelCost) {
                            const policeCheck = Math.random() * 100;
                            const currentPolice = gameState.policePresence.get(destination);
                            if (policeCheck < currentPolice) {
                                if (Math.random() < (gameState.risk / 100)) {
                                    gameOver("Arr√™t√© pendant le voyage !");
                                    return;
                                }
                            }
                            gameState.money -= travelCost;
                            gameState.currentLocation = destination;
                            gameState.risk = Math.min(CONFIG.MAX_RISK, gameState.risk + Math.floor(Math.random() * 10));
                            showNotification(`Voyage vers ${destination} r√©ussi.`, "success");
                            console.log(`Voyage effectu√© vers ${destination}. Risque actuel: ${gameState.risk}`);
                            const overdueMissionsInCity = gameState.missions.filter(mission =>
                                mission.targetCity === gameState.currentLocation &&
                                mission.status === 'active' &&
                                Date.now() > mission.deadline.getTime()
                            );
                            if (overdueMissionsInCity.length > 0) {
                                if (Math.random() < 0.7) {
                                    const damage = Math.floor(Math.random() * 20) + 10;
                                    gameState.health -= damage;
                                    gameState.health = Math.max(0, gameState.health);
                                    showNotification(`Vous avez √©t√© attaqu√© par vos cr√©anciers et avez perdu ${damage}% de sant√©!`, "error");
                                    console.warn(`Attaque des cr√©anciers: perte de ${damage}% de sant√©.`);
                                    if (gameState.health <= 0) {
                                        gameOver("Vous avez √©t√© √©limin√© par vos cr√©anciers!");
                                        return;
                                    }
                                }
                            }
                            populateLocationSelect();
                            updateTargetsList();
                            updateUI();
                        } else {
                            showNotification("Fonds insuffisants pour voyager.", "error");
                            console.warn("Tentative de voyage avec des fonds insuffisants.");
                        }
                    } else {
                        showNotification("Vous √™tes d√©j√† dans cette ville.", "warning");
                        console.warn("Tentative de voyage vers la m√™me ville.");
                    }
                }
                function updateTargetsList() {
                    const targetsList = document.getElementById("targets-available");
                    targetsList.innerHTML = "";
                    const currentTargets = gameState.cityTargets[gameState.currentLocation];
                    if (currentTargets && currentTargets.length > 0) {
                        currentTargets.forEach(target => {
                            const listItem = document.createElement("li");
                            listItem.textContent = target;
                            targetsList.appendChild(listItem);
                            console.log(`Cible disponible: ${target}`);
                        });
                        document.getElementById("target-list").classList.remove("hidden");
                    } else {
                        targetsList.innerHTML = "<li>Aucune cible disponible.</li>";
                        document.getElementById("target-list").classList.add("hidden");
                        console.log("Aucune cible disponible pour cette ville.");
                    }
                }
                function updateMarketDisplay() {
                    const marketItems = document.getElementById("market-items");
                    marketItems.innerHTML = "";
                    GAME_DATA.items.forEach(item => {
                        const cityData = marketData[gameState.currentLocation][item.id];
                        if (cityData.available) {
                            const price = calculatePrice(item);
                            const trend = cityData.trend;
                            const itemDiv = document.createElement("div");
                            itemDiv.className = "flex justify-between items-center p-2 bg-[rgba(26,27,38,0.8)] rounded-lg";
                            itemDiv.innerHTML = `
                                <div>
                                    <p class="font-bold">${item.name}</p>
                                    <p>${item.type}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span>${price} $</span>
                                    <span>${trend}</span>
                                    <button onclick="buyItem(${item.id})" class="btn-cyber px-2 py-1">Acheter</button>
                                </div>
                            `;
                            marketItems.appendChild(itemDiv);
                            console.log(`Affichage de l'item sur le march√©: ${item.name}, Prix: ${price}$`);
                        }
                    });
                    toggleSectionVisibility(marketItems, "March√©");
                }
                function updateDarkwebList() {
                    const darkwebList = document.getElementById("darkweb-list");
                    darkwebList.innerHTML = "";
                    gameState.darkwebServices.forEach(service => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td class="p-2">${service.name}</td>
                            <td class="p-2">${service.price} $</td>
                            <td class="p-2">${service.description}</td>
                            <td class="p-2">
                                <button onclick="buyDarkwebService(${service.id})" class="btn-cyber btn-sm px-2 py-1">Acheter</button>
                            </td>
                        `;
                        darkwebList.appendChild(row);
                        console.log(`Affichage du service Darkweb: ${service.name}, Prix: ${service.price}$`);
                    });
                    toggleSectionVisibility(darkwebList, "Darkweb");
                }
                function updateMarketPrices() {
                    gameState.availableCities.forEach(city => {
                        GAME_DATA.items.forEach(item => {
                            const marketItem = marketData[city][item.id];
                            if (marketItem.available) {
                                const fluctuation = (Math.random() * 0.2 - 0.1) * marketItem.price;
                                marketItem.price += fluctuation;
                                marketItem.price = Math.max(10, Math.round(marketItem.price));
                                marketItem.trend = fluctuation > 0 ? "‚ÜóÔ∏è" : "‚ÜòÔ∏è";
                                console.log(`Mise √† jour du prix de ${item.name} √† ${city}: ${marketItem.price}$, Tendance: ${marketItem.trend}`);
                            }
                        });
                    });
                    updateMarketDisplay();
                    updatePriceList();
                }
                function checkMissions() {
                    updateMissionsStatus();
                    updateMissionsList();
                }
                let gameIntervals = [];
                
                function gameOver(reason) {
                    // Stop all intervals
                    gameIntervals.forEach(interval => clearInterval(interval));
                    gameIntervals = [];
                
                    // Set gameOver flag to true
                    gameState.gameOver = true;
                
                    // Disable interactive elements
                    document.querySelectorAll('.btn-cyber, .btn-cyber2').forEach(btn => {
                        btn.disabled = true;
                    });
                
                    // Show Game Over Screen
                    document.getElementById('game-over-modal').classList.remove('hidden');
                    document.getElementById('game-over-reason').textContent = reason;
                
                    showNotification(reason, "error");
                    console.error(`Game Over: ${reason}`);
                }
                function toggleSectionVisibility(element, sectionName) {
                    const parentSection = element.closest("div");
                    if (element.children.length > 0) {
                        parentSection.classList.remove("hidden");
                    } else {
                        parentSection.classList.add("hidden");
                    }
                }
                function decreaseRisk() {
                    if (gameState.risk > 0) {
                        gameState.risk *= CONFIG.RISK_DECREASE_DECAY;
                        gameState.risk = parseFloat(gameState.risk.toFixed(2));
                        if (gameState.risk < 0.1) gameState.risk = 0;
                        console.log(`Risque diminu√© √†: ${gameState.risk}%`);
                        updateUI();
                    }
                }
                function resetGame() {
                    if (confirm("Voulez-vous vraiment r√©initialiser le jeu ? Cela supprimera toutes vos donn√©es.")) {
                        resetGameState();
                    }
                }
                function submitScore() {
                    const playerName = document.getElementById('player-name').value.trim() || 'Anonyme';
                    if (playerName.length === 0) {
                        showNotification("Veuillez entrer un pseudo valide.", "error");
                        return;
                    }
                    const score = {
                        name: playerName,
                        money: gameState.money,
                        elapsedTime: formatElapsedTime(),
                        date: new Date().toLocaleString('fr-FR')
                    };
                    let hallOfFame = JSON.parse(localStorage.getItem('hallOfFame')) || [];
                    hallOfFame.push(score);
                    hallOfFame.sort((a, b) => b.money - a.money);
                    hallOfFame = hallOfFame.slice(0, 10);
                    localStorage.setItem('hallOfFame', JSON.stringify(hallOfFame));
                    console.log(`Score soumis: ${playerName}, Argent: ${gameState.money}$`);
                    resetGameState();
                    document.getElementById('game-over-modal').classList.add('hidden');
                    showHallOfFame();
                }
                function showHallOfFame() {
                    const hallOfFame = JSON.parse(localStorage.getItem('hallOfFame')) || [];
                    const hallOfFameList = document.getElementById('hall-of-fame-list');
                    hallOfFameList.innerHTML = '';
                    if (hallOfFame.length > 0) {
                        const table = document.createElement('table');
                        table.className = 'w-full';
                        const thead = document.createElement('thead');
                        thead.innerHTML = `
                            <tr>
                                <th class="p-2 text-left">Pseudo</th>
                                <th class="p-2 text-left">Argent</th>
                                <th class="p-2 text-left">Temps √âcoul√©</th>
                                <th class="p-2 text-left">Date</th>
                            </tr>
                        `;
                        table.appendChild(thead);
                        const tbody = document.createElement('tbody');
                        hallOfFame.forEach(entry => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="p-2">${entry.name}</td>
                                <td class="p-2">${entry.money} $</td>
                                <td class="p-2">${entry.elapsedTime}</td>
                                <td class="p-2">${entry.date}</td>
                            `;
                            tbody.appendChild(row);
                            console.log(`Entr√©e Hall of Fame: ${entry.name}, Argent: ${entry.money}$`);
                        });
                        table.appendChild(tbody);
                        hallOfFameList.appendChild(table);
                    } else {
                        hallOfFameList.innerHTML = '<p>Aucun score enregistr√© pour le moment.</p>';
                        console.log("Hall of Fame vide.");
                    }
                    document.getElementById('hall-of-fame-modal').classList.remove('hidden');
                }
                function checkForCreditorAggressions() {
                    gameState.loans.forEach(loan => {
                        if (loan.status === "defaulted" && gameState.currentLocation === loan.city) {
                            if (Math.random() < 0.5) {
                                const damage = Math.floor(Math.random() * 20) + 10;
                                gameState.health -= damage;
                                showNotification(`Agression par les cr√©anciers ! Vous perdez ${damage}% de sant√©.`, "error");
                                console.warn(`Agression des cr√©anciers: perte de ${damage}% de sant√©.`);
                                if (gameState.health <= 0) {
                                    gameOver("Vous avez √©t√© √©limin√© par vos cr√©anciers !");
                                }
                            }
                        }
                    });
                }
                document.addEventListener('DOMContentLoaded', () => {
                    initGame();
                });
            </script>
        </div>
    </body>
</html>
