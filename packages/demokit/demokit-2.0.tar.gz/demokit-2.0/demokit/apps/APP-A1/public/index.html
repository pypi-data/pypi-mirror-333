<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>OWASP A01:2021 - Contr√¥les d'Acc√®s D√©faillants</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tab button.active {
            background-color: #ccc;
        }
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
        }
        .visible {
            display: block;
        }
        .demo-box {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            background-color: #f9f9f9;
        }
        .warning {
            background-color: #fff3cd;
            padding: 10px;
            border: 1px solid #ffeeba;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            margin: 10px 0;
        }
        code {
            background-color: #f8f9fa;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: monospace;
        }
        input[type="text"], input[type="number"] {
            padding: 8px;
            margin: 5px 0;
            width: 300px;
        }
        button {
            padding: 8px 15px;
            cursor: pointer;
        }
        .progress-steps {
            margin: 20px 0;
            padding: 0;
            list-style: none;
        }
        .progress-steps li {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 3px solid #dee2e6;
        }
        .progress-steps li.completed {
            background: #d4edda;
            border-left: 3px solid #28a745;
        }
        .url-input {
            width: 100%;
            padding: 10px;
            font-family: monospace;
            margin: 10px 0;
        }
        .step-hint {
            display: none;
            color: #666;
            font-style: italic;
            margin: 10px 0;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeeba;
        }
        .flag {
            color: #28a745;
            font-weight: bold;
        }
        .challenge {
            background-color: #e9ecef;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .user-card {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            background-color: white;
        }
        .documentation {
            margin-top: 40px;
            border-top: 2px solid #dee2e6;
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <h1>OWASP A01:2021 - D√©monstration des Contr√¥les d'Acc√®s D√©faillants</h1>
    
    <div class="warning">
        ‚ö†Ô∏è Cette application est intentionnellement vuln√©rable √† des fins √©ducatives.
        Ne l'utilisez jamais en production.
    </div>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'idor')" id="defaultOpen">D√©fi IDOR</button>
        <button class="tablinks" onclick="openTab(event, 'function')">D√©fi Contr√¥le d'Acc√®s</button>
    </div>

    <div id="idor" class="tabcontent">
        <h2>D√©fi IDOR - Infiltration Progressive</h2>
        
        <div class="challenge">
            <h3>üéØ Mission</h3>
            <p>Vous √™tes un pentester charg√© d'√©valuer la s√©curit√© d'une application web. Votre objectif est de d√©montrer les vuln√©rabilit√©s IDOR en acc√©dant progressivement √† des informations de plus en plus sensibles.</p>
            <p>Contexte : Vous √™tes connect√© en tant que Bob (user_id=2)</p>
        </div>

        <div class="demo-box">
            <h3>Interface de Test</h3>
            <p>Modifier l'URL pour acc√©der aux diff√©rentes ressources :</p>
            <input type="text" id="url_input" class="url-input" value="/api/profile?user_id=2" onkeyup="checkUrl(this.value)">
            <button onclick="testUrl()">Tester l'URL</button>
            
            <div id="response_area"></div>

            <ul class="progress-steps" id="progress_steps">
                <li id="step1">
                    √âtape 1 : Trouver le profil d'Alice (FLAG_1)
                    <button onclick="showHint(1)" class="hint-btn">Indice</button>
                    <div id="hint1" class="step-hint">Essayez de modifier le user_id dans l'URL...</div>
                </li>
                <li id="step2">
                    √âtape 2 : Acc√©der aux messages priv√©s d'Alice (FLAG_2)
                    <button onclick="showHint(2)" class="hint-btn">Indice</button>
                    <div id="hint2" class="step-hint">L'endpoint des messages est /api/messages?user_id=X</div>
                </li>
                <li id="step3">
                    √âtape 3 : Trouver l'administrateur (FLAG_3)
                    <button onclick="showHint(3)" class="hint-btn">Indice</button>
                    <div id="hint3" class="step-hint">Les IDs sont s√©quentiels...</div>
                </li>
                <li id="step4">
                    √âtape 4 : Acc√©der aux notes confidentielles de l'admin (FLAG_4)
                    <button onclick="showHint(4)" class="hint-btn">Indice</button>
                    <div id="hint4" class="step-hint">Essayez /api/notes?user_id=X</div>
                </li>
            </ul>
        </div>
    </div>

    <div id="function" class="tabcontent">
        <h2>D√©fi Contr√¥le d'Acc√®s - Panel Administrateur</h2>
        
        <div class="challenge">
            <h3>üéØ Mission</h3>
            <p>Vous √™tes un utilisateur normal. Votre mission est d'acc√©der au panneau d'administration et de trouver le code secret.</p>
        </div>

        <div class="demo-box">
            <h3>Interface Web</h3>
            <select id="user_role">
                <option value="user">Utilisateur Normal</option>
                <option value="guest">Invit√©</option>
            </select>
            
            <button onclick="accessAdminPanel()">Acc√©der au panneau d'administration</button>
            
            <div id="admin_panel"></div>
            <div id="admin_success" class="success" style="display: none;">
                üéâ F√©licitations ! Vous avez contourn√© les contr√¥les d'acc√®s !
                <br><br>
                <strong>Code secret trouv√© :</strong> "ADMIN_XYZ_123"
            </div>
        </div>

        <div class="hint">
            üí° Indice: Inspectez le code JavaScript de la page...
        </div>

        <div class="demo-box">
            <h3>Code Source Visible</h3>
            <pre>
function accessAdminPanel() {
    if (isAdmin || userRole === 'admin') {
        showAdminContent();
    } else {
        showAccessDenied();
    }
}
            </pre>
        </div>
    </div>

    <script>
        const ENDPOINTS = {
            profile: /^\/api\/profile\?user_id=(\d+)$/,
            messages: /^\/api\/messages\?user_id=(\d+)$/,
            notes: /^\/api\/notes\?user_id=(\d+)$/
        };

        const USERS = {
            1: {
                id: 1,
                name: "Alice",
                email: "alice@company.com",
                role: "user",
                messages: ["Message priv√© pour RH", "R√©union √† 14h"],
            },
            2: {
                id: 2,
                name: "Bob",
                email: "bob@company.com",
                role: "user",
                messages: ["Rappel: envoyer rapport", "Todo list"],
            },
            3: {
                id: 3,
                name: "Admin",
                email: "admin@company.com",
                role: "admin",
                messages: ["Configuration serveur", "Revue s√©curit√©"],
                notes: ["Flag final: ADMIN_SUPER_SECRET_FLAG", "Mot de passe syst√®me: admin123"]
            }
        };

        let completedSteps = new Set();
        let foundFlags = new Set();
        let isAdmin = false;

        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        function testUrl() {
            const url = document.getElementById('url_input').value;
            const responseArea = document.getElementById('response_area');
            let response = "URL invalide";

            if (url.match(ENDPOINTS.profile)) {
                const userId = url.match(ENDPOINTS.profile)[1];
                if (USERS[userId]) {
                    response = JSON.stringify(USERS[userId], null, 2);
                    if (userId === "1") {
                        completeStep(1, "FLAG_ALICE_PROFILE_FOUND");
                    }
                    if (userId === "3") {
                        completeStep(3, "FLAG_ADMIN_FOUND");
                    }
                }
            }
            else if (url.match(ENDPOINTS.messages)) {
                const userId = url.match(ENDPOINTS.messages)[1];
                if (USERS[userId]) {
                    response = JSON.stringify({messages: USERS[userId].messages}, null, 2);
                    if (userId === "1") {
                        completeStep(2, "FLAG_ALICE_MESSAGES_FOUND");
                    }
                }
            }
            else if (url.match(ENDPOINTS.notes)) {
                const userId = url.match(ENDPOINTS.notes)[1];
                if (USERS[userId] && USERS[userId].notes) {
                    response = JSON.stringify({notes: USERS[userId].notes}, null, 2);
                    if (userId === "3") {
                        completeStep(4, "FLAG_ADMIN_NOTES_FOUND");
                    }
                }
            }

            responseArea.innerHTML = `<pre>${response}</pre>`;
        }

        function completeStep(stepNum, flag) {
            if (!completedSteps.has(stepNum)) {
                completedSteps.add(stepNum);
                foundFlags.add(flag);
                const step = document.getElementById(`step${stepNum}`);
                step.classList.add('completed');
                step.innerHTML += `<div class="flag">üö© Flag trouv√©: ${flag}</div>`;
                
                if (completedSteps.size === 4) {
                    document.getElementById('response_area').innerHTML += `
                        <div class="success">
                            üéâ F√©licitations ! Vous avez termin√© le d√©fi IDOR !
                            Flags trouv√©s : ${Array.from(foundFlags).join(', ')}
                        </div>`;
                }
            }
        }
        
    function checkUrl(value) {
        if (value.match(ENDPOINTS.profile) || 
            value.match(ENDPOINTS.messages) || 
            value.match(ENDPOINTS.notes)) {
            testUrl();
        }
    }

        function showHint(stepNum) {
            const hint = document.getElementById(`hint${stepNum}`);
            hint.style.display = hint.style.display === 'block' ? 'none' : 'block';
        }

        function accessAdminPanel() {
            const panel = document.getElementById('admin_panel');
            const role = document.getElementById('user_role').value;
            
            if (isAdmin || role === 'admin') {
                panel.innerHTML = `
                    <div class="demo-box">
                        <h4>Panneau d'Administration</h4>
                        <p>Code secret : ADMIN_XYZ_123</p>
                        <button onclick="alert('Action sensible effectu√©e!')">Supprimer des utilisateurs</button>
                    </div>`;
                document.getElementById('admin_success').style.display = 'block';
            } else {
                panel.innerHTML = '<p>Acc√®s refus√©. Vous n\'avez pas les droits administrateur.</p>';
            }
        }

        document.getElementById("defaultOpen").click();
    </script>
</body>
</html>
